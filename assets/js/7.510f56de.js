(window.webpackJsonp=window.webpackJsonp||[]).push([[7],{183:function(t,s,a){t.exports=a.p+"assets/img/nginxflow.1480e750.png"},210:function(t,s,a){"use strict";a.r(s);var n=a(6),e=Object(n.a)({},(function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[n("h1",{attrs:{id:"nginx"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#nginx"}},[t._v("#")]),t._v(" Nginx")]),t._v(" "),n("p",[t._v("Nginx (engine x) 是一个高性能的 HTTP 和反向代理 web 服务器，同时也提供了 IMAP/POP3/SMTP 服务。Nginx 是由伊戈尔·赛索耶夫为俄罗斯访问量第二的 Rambler.ru 站点（俄文：Рамблер）开发的，第一个公开版本 0.1.0 发布于 2004 年 10 月 4 日。")]),t._v(" "),n("h2",{attrs:{id:"_1-nginx-使用场景"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_1-nginx-使用场景"}},[t._v("#")]),t._v(" 1. nginx 使用场景")]),t._v(" "),n("ul",[n("li",[t._v("静态资源服务器")]),t._v(" "),n("li",[t._v("反向代理服务")]),t._v(" "),n("li",[t._v("API 接口服务(Lua&Javascript)")])]),t._v(" "),n("h2",{attrs:{id:"_2-nginx-的优点"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-nginx-的优点"}},[t._v("#")]),t._v(" 2. nginx 的优点")]),t._v(" "),n("ul",[n("li",[t._v("高并发高性能 (几十万无压力)")]),t._v(" "),n("li",[t._v("可扩展性好 (内核精简，可进行二次编程)")]),t._v(" "),n("li",[t._v("高可靠性 (很稳定)")]),t._v(" "),n("li",[t._v("热布署 (不需要重启)")]),t._v(" "),n("li",[t._v("开源许可证 (免费开源)")])]),t._v(" "),n("h2",{attrs:{id:"_3-使用"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_3-使用"}},[t._v("#")]),t._v(" 3. 使用")]),t._v(" "),n("h3",{attrs:{id:"_3-1-关闭防火墙"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-关闭防火墙"}},[t._v("#")]),t._v(" 3.1 关闭防火墙")]),t._v(" "),n("table",[n("thead",[n("tr",[n("th",[t._v("命令")]),t._v(" "),n("th",[t._v("作用")])])]),t._v(" "),n("tbody",[n("tr",[n("td",[t._v("systemctl stop firewalld.service")]),t._v(" "),n("td",[t._v("停止防火墙")])]),t._v(" "),n("tr",[n("td",[t._v("systemctl disable firewalld.service")]),t._v(" "),n("td",[t._v("永久关闭防火墙")])])])]),t._v(" "),n("h3",{attrs:{id:"_3-2-确认停用-selinux"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-确认停用-selinux"}},[t._v("#")]),t._v(" 3.2 确认停用 selinux")]),t._v(" "),n("ul",[n("li",[t._v("安全增强型 Linux（Security-Enhanced Linux）简称 SELinux，它是一个 Linux 内核模块，也是 Linux 的一个安全子系统。")]),t._v(" "),n("li",[t._v("SELinux 主要作用就是最大限度地减小系统中服务进程可访问的资源（最小权限原则）。")])]),t._v(" "),n("table",[n("thead",[n("tr",[n("th",[t._v("命令")]),t._v(" "),n("th",[t._v("作用")])])]),t._v(" "),n("tbody",[n("tr",[n("td",[t._v("getenforce")]),t._v(" "),n("td",[t._v("检查状态")])]),t._v(" "),n("tr",[n("td",[t._v("/usr/sbin/sestatus -v")]),t._v(" "),n("td",[t._v("检查状态")])]),t._v(" "),n("tr",[n("td",[t._v("setenforce 0")]),t._v(" "),n("td",[t._v("临时关闭")])]),t._v(" "),n("tr",[n("td",[t._v("/etc/selinux/config SELINUX=enforcing 改为 SELINUX=disabled")]),t._v(" "),n("td",[t._v("永久关闭")])])])]),t._v(" "),n("h3",{attrs:{id:"_3-3-安装依赖模块"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_3-3-安装依赖模块"}},[t._v("#")]),t._v(" 3.3 安装依赖模块")]),t._v(" "),n("div",{staticClass:"language-bash extra-class"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[t._v("yum  -y "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" gcc gcc-c++ autoconf pcre pcre-devel "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("make")]),t._v(" automake openssl openssl-devel\n")])])]),n("table",[n("thead",[n("tr",[n("th",[t._v("软件包")]),t._v(" "),n("th",[t._v("描述")])])]),t._v(" "),n("tbody",[n("tr",[n("td",[t._v("gcc")]),t._v(" "),n("td",[t._v("gcc 是指整个 gcc 的这一套工具集合，它分为 gcc 前端和 gcc 后端（我个人理解为 gcc 外壳和 gcc 引擎），gcc 前端对应各种特定语言（如 c++/go 等）的处理（对 c++/go 等特定语言进行对应的语法检查, 将 c++/go 等语言的代码转化为 c 代码等），gcc 后端对应把前端的 c 代码转为跟你的电脑硬件相关的汇编或机器码")])]),t._v(" "),n("tr",[n("td",[t._v("gcc-c++")]),t._v(" "),n("td",[t._v("而就软件程序包而言，gcc.rpm 就是那个 gcc 后端，而 gcc-c++.rpm 就是针对 c++这个特定语言的 gcc 前端")])]),t._v(" "),n("tr",[n("td",[t._v("autoconf")]),t._v(" "),n("td",[t._v("autoconf 是一个软件包，以适应多种 Unix 类系统的 shell 脚本的工具")])]),t._v(" "),n("tr",[n("td",[t._v("pcre")]),t._v(" "),n("td",[t._v("PCRE(Perl Compatible Regular Expressions)是一个 Perl 库，包括 perl 兼容的正则表达式库")])]),t._v(" "),n("tr",[n("td",[t._v("pcre-devel")]),t._v(" "),n("td",[t._v("devel 包主要是供开发用,包含头文件和链接库")])]),t._v(" "),n("tr",[n("td",[t._v("make")]),t._v(" "),n("td",[t._v("常指一条计算机指令，是在安装有 GNU Make 的计算机上的可执行指令。该指令是读入一个名为 makefile 的文件，然后执行这个文件中指定的指令")])]),t._v(" "),n("tr",[n("td",[t._v("automake")]),t._v(" "),n("td",[t._v("automake 可以用来帮助我们自动地生成符合自由软件惯例的 Makefile")])]),t._v(" "),n("tr",[n("td",[t._v("wget")]),t._v(" "),n("td",[t._v("wget 是一个从网络上自动下载文件的自由工具，支持通过 HTTP、HTTPS、FTP 三个最常见的 TCP/IP 协议 下载，并可以使用 HTTP 代理")])]),t._v(" "),n("tr",[n("td",[t._v("httpd-tools")]),t._v(" "),n("td",[t._v("apace 压力测试")])]),t._v(" "),n("tr",[n("td",[t._v("vim")]),t._v(" "),n("td",[t._v("Vim 是一个类似于 Vi 的著名的功能强大、高度可定制的文本编辑器")])])])]),t._v(" "),n("table",[n("thead",[n("tr",[n("th",[t._v("目录名")]),t._v(" "),n("th",[t._v("含义")])])]),t._v(" "),n("tbody",[n("tr",[n("td",[t._v("app")]),t._v(" "),n("td",[t._v("存放代码和应用")])]),t._v(" "),n("tr",[n("td",[t._v("backup")]),t._v(" "),n("td",[t._v("存放备份的文件")])]),t._v(" "),n("tr",[n("td",[t._v("download")]),t._v(" "),n("td",[t._v("下载下来的代码和安装包")])]),t._v(" "),n("tr",[n("td",[t._v("logs")]),t._v(" "),n("td",[t._v("放日志的")])]),t._v(" "),n("tr",[n("td",[t._v("work")]),t._v(" "),n("td",[t._v("工作目录")])])])]),t._v(" "),n("h2",{attrs:{id:"_4-nginx-的架构"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_4-nginx-的架构"}},[t._v("#")]),t._v(" 4. nginx 的架构")]),t._v(" "),n("h3",{attrs:{id:"_4-1-轻量"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_4-1-轻量"}},[t._v("#")]),t._v(" 4.1 轻量")]),t._v(" "),n("ul",[n("li",[t._v("源代码只包含核心模块")]),t._v(" "),n("li",[t._v("其它非核心功能都是通过模块实现，可以自由选择")])]),t._v(" "),n("h3",{attrs:{id:"_4-2-架构"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_4-2-架构"}},[t._v("#")]),t._v(" 4.2 架构")]),t._v(" "),n("ul",[n("li",[t._v("Nginx 采用的是多进程(单线程)和多路 IO 复用模型")])]),t._v(" "),n("h4",{attrs:{id:"_4-2-1-工作流程"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_4-2-1-工作流程"}},[t._v("#")]),t._v(" 4.2.1 工作流程")]),t._v(" "),n("ul",[n("li",[t._v("Nginx 在启动后，会有一个 master 进程和多个相互独立的 worker 进程。")]),t._v(" "),n("li",[t._v("接收来自外界的信号,向各 worker 进程发送信号,每个进程都有可能来处理这个连接。")]),t._v(" "),n("li",[t._v("master 进程能监控 worker 进程的运行状态，当 worker 进程退出后(异常情况下)，会自动启动新的 worker 进程。")]),t._v(" "),n("li",[t._v("worker 进程数，一般会设置成机器 cpu 核数。因为更多的 worker 数，只会导致进程相互竞争 cpu，从而带来不必要的上下文切换")]),t._v(" "),n("li",[t._v("使用多进程模式，不仅能提高并发率，而且进程之间相互独立，一个 worker 进程挂了不会影响到其他 worker 进程")])]),t._v(" "),n("h4",{attrs:{id:"_4-2-2-io-多路复用"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_4-2-2-io-多路复用"}},[t._v("#")]),t._v(" 4.2.2 IO 多路复用")]),t._v(" "),n("ul",[n("li",[t._v("多个文件描述符的 IO 操作都能在一个线程里并发交替顺序完成，复用线程")])]),t._v(" "),n("h4",{attrs:{id:"_4-2-4-cpu-亲和"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_4-2-4-cpu-亲和"}},[t._v("#")]),t._v(" 4.2.4 CPU 亲和")]),t._v(" "),n("ul",[n("li",[t._v("把 CPU 内核和 nginx 的工作进程绑定在一起，让每个 worker 进程固定在一个 CPU 上执行，从而减少 CPU 的切换并提高缓存命中率，提高 性能")])]),t._v(" "),n("h4",{attrs:{id:"_4-2-5-sendfile"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_4-2-5-sendfile"}},[t._v("#")]),t._v(" 4.2.5 sendfile")]),t._v(" "),n("ul",[n("li",[t._v("sendfile 零拷贝传输模式")])]),t._v(" "),n("h2",{attrs:{id:"_5-安装"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_5-安装"}},[t._v("#")]),t._v(" 5. 安装")]),t._v(" "),n("h3",{attrs:{id:"_5-1-版本"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_5-1-版本"}},[t._v("#")]),t._v(" 5.1 版本")]),t._v(" "),n("ul",[n("li",[t._v("Mainline version 开发版")]),t._v(" "),n("li",[t._v("Stable version 稳定版")]),t._v(" "),n("li",[t._v("Legacy versions 历史版本")])]),t._v(" "),n("h3",{attrs:{id:"_5-2-下载地址"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_5-2-下载地址"}},[t._v("#")]),t._v(" 5.2 下载地址")]),t._v(" "),n("ul",[n("li",[n("a",{attrs:{href:"http://nginx.org/en/download.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("下载地址"),n("OutboundLink")],1)]),t._v(" "),n("li",[n("a",{attrs:{href:"http://nginx.org/en/linux_packages.html#stable",target:"_blank",rel:"noopener noreferrer"}},[t._v("linux_packages"),n("OutboundLink")],1)])]),t._v(" "),n("h3",{attrs:{id:"_5-3-centos-下-yum-安装"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_5-3-centos-下-yum-安装"}},[t._v("#")]),t._v(" 5.3 CentOS 下 YUM 安装")]),t._v(" "),n("div",{staticClass:"language-bash extra-class"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 添加安装源")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("vi")]),t._v(" /etc/yum.repos.d/nginx.repo\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 写入内容")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("nginx"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("name")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("nginx repo\n"),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("baseurl")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("http://nginx.org/packages/centos/7/"),n("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$basearch")]),t._v("/\n"),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("gpgcheck")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("enabled")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#下载")]),t._v("\nyum "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" nginx -y "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 安装nginx")]),t._v("\nnginx -v "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 查看安装的版本")]),t._v("\nnginx -V "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 查看编译时的参数")]),t._v("\n")])])]),n("h2",{attrs:{id:"_6-目录"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_6-目录"}},[t._v("#")]),t._v(" 6. 目录")]),t._v(" "),n("h3",{attrs:{id:"_6-1-安装目录"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_6-1-安装目录"}},[t._v("#")]),t._v(" 6.1 安装目录")]),t._v(" "),n("div",{staticClass:"language-bash extra-class"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 查看nginx安装的配置文件和目录")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("rpm")]),t._v(" -ql nginx\n")])])]),n("h3",{attrs:{id:"_6-2-日志切割文件"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_6-2-日志切割文件"}},[t._v("#")]),t._v(" 6.2 日志切割文件")]),t._v(" "),n("div",{staticClass:"language-bash extra-class"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 查看日志配置")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("cat")]),t._v(" /etc/logrotate.d/nginx\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 对访问日志进行切割")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 每天都生成一个日志文件，就是所谓的日志切割")]),t._v("\n/var/log/nginx/*.log "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  daily\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 查看所有的log文件")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("ls")]),t._v(" /var/log/nginx/*.log\n")])])]),n("h3",{attrs:{id:"_6-3-主配置文件"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_6-3-主配置文件"}},[t._v("#")]),t._v(" 6.3 主配置文件")]),t._v(" "),n("table",[n("thead",[n("tr",[n("th",[t._v("路径")]),t._v(" "),n("th",[t._v("概念")])])]),t._v(" "),n("tbody",[n("tr",[n("td",[t._v("/etc/nginx/nginx.conf")]),t._v(" "),n("td",[t._v("核心配置文件")])]),t._v(" "),n("tr",[n("td",[t._v("/etc/nginx/conf.d/default.conf")]),t._v(" "),n("td",[t._v("默认 http 服务器配置文件")])])])]),t._v(" "),n("h3",{attrs:{id:"_6-4-守护进程管理"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_6-4-守护进程管理"}},[t._v("#")]),t._v(" 6.4 守护进程管理")]),t._v(" "),n("div",{staticClass:"language-bash extra-class"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 用于配置系统守护进程管理器管理方式")]),t._v("\nsystemctl restart nginx.service\n")])])]),n("h3",{attrs:{id:"_6-5-nginx-模块目录"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_6-5-nginx-模块目录"}},[t._v("#")]),t._v(" 6.5 nginx 模块目录")]),t._v(" "),n("table",[n("thead",[n("tr",[n("th",[t._v("路径")]),t._v(" "),n("th",[t._v("概念")])])]),t._v(" "),n("tbody",[n("tr",[n("td",[t._v("/etc/nginx/modules")]),t._v(" "),n("td",[t._v("最基本的共享库和内核模块")])])])]),t._v(" "),n("p",[t._v("nginx 的安装模块，目的是存放用于启动系统和执行 root 文件系统的命令的如/bin 和/sbin 的二进制文件的共享库，或者存放 32 位，或者 64 位(file 命令查看)| | /usr/lib64/nginx/modules |64 位共享库|")]),t._v(" "),n("h3",{attrs:{id:"_6-6-文档"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_6-6-文档"}},[t._v("#")]),t._v(" 6.6 文档")]),t._v(" "),n("p",[t._v("nginx 的手册和帮助文件")]),t._v(" "),n("table",[n("thead",[n("tr",[n("th",[t._v("路径")]),t._v(" "),n("th",[t._v("概念")])])]),t._v(" "),n("tbody",[n("tr",[n("td",[t._v("/usr/share/doc/nginx-1.14.2")]),t._v(" "),n("td",[t._v("帮助文档")])]),t._v(" "),n("tr",[n("td",[t._v("/usr/share/doc/nginx-1.14.0/COPYRIGHT")]),t._v(" "),n("td",[t._v("版权声明")])]),t._v(" "),n("tr",[n("td",[t._v("/usr/share/man/man8/nginx.8.gz")]),t._v(" "),n("td",[t._v("手册")])])])]),t._v(" "),n("h3",{attrs:{id:"_6-7-缓存目录"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_6-7-缓存目录"}},[t._v("#")]),t._v(" 6.7 缓存目录")]),t._v(" "),n("table",[n("thead",[n("tr",[n("th",[t._v("路径")]),t._v(" "),n("th",[t._v("概念")])])]),t._v(" "),n("tbody",[n("tr",[n("td",[t._v("/var/cache/nginx")]),t._v(" "),n("td",[t._v("nginx 的缓存目录")])])])]),t._v(" "),n("h3",{attrs:{id:"_6-8-日志目录"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_6-8-日志目录"}},[t._v("#")]),t._v(" 6.8 日志目录")]),t._v(" "),n("table",[n("thead",[n("tr",[n("th",[t._v("路径")]),t._v(" "),n("th",[t._v("概念")])])]),t._v(" "),n("tbody",[n("tr",[n("td",[t._v("/var/log/nginx")]),t._v(" "),n("td",[t._v("nginx 的日志目录")])])])]),t._v(" "),n("h3",{attrs:{id:"_6-9-可执行命令"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_6-9-可执行命令"}},[t._v("#")]),t._v(" 6.9 可执行命令")]),t._v(" "),n("p",[t._v("nginx 服务的启动管理的可执行文件（重要）")]),t._v(" "),n("table",[n("thead",[n("tr",[n("th",[t._v("路径")]),t._v(" "),n("th",[t._v("概念")])])]),t._v(" "),n("tbody",[n("tr",[n("td",[t._v("/usr/sbin/nginx")]),t._v(" "),n("td",[t._v("可执行命令")])]),t._v(" "),n("tr",[n("td",[t._v("/usr/sbin/nginx-debug")]),t._v(" "),n("td",[t._v("调试执行可执行命令")])])])]),t._v(" "),n("h2",{attrs:{id:"_7-编译参数"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_7-编译参数"}},[t._v("#")]),t._v(" 7. 编译参数")]),t._v(" "),n("h3",{attrs:{id:"_7-1-安装目录和路径"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_7-1-安装目录和路径"}},[t._v("#")]),t._v(" 7.1 安装目录和路径")]),t._v(" "),n("div",{staticClass:"language-bash extra-class"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[t._v("--prefix"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("/etc/nginx //安装目录\n--sbin-path"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("/usr/sbin/nginx //可执行文件\n--modules-path"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("/usr/lib64/nginx/modules //安装模块\n--conf-path"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("/etc/nginx/nginx.conf  //配置文件路径\n--error-log-path"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("/var/log/nginx/error.log  //错误日志\n--http-log-path"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("/var/log/nginx/access.log  //访问日志\n--pid-path"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("/var/run/nginx.pid //进程ID\n--lock-path"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("/var/run/nginx.lock //加锁对象\n")])])]),n("h3",{attrs:{id:"_7-2-指定用户"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_7-2-指定用户"}},[t._v("#")]),t._v(" 7.2 指定用户")]),t._v(" "),n("ul",[n("li",[t._v("配置 nginx 进程启动的用户和用户组")])]),t._v(" "),n("div",{staticClass:"language-bash extra-class"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[t._v("--user"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("nginx   "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#指定用户")]),t._v("\n--group"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("nginx  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#指定用户组")]),t._v("\n")])])]),n("h2",{attrs:{id:"_8-配置文件"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_8-配置文件"}},[t._v("#")]),t._v(" 8. 配置文件")]),t._v(" "),n("ul",[n("li",[t._v("/etc/nginx/nginx.conf #主配置文件")]),t._v(" "),n("li",[t._v("/etc/nginx/conf.d/*.conf #包含 conf.d 目录下面的所有配置文件")]),t._v(" "),n("li",[t._v("/etc/nginx/conf.d/default.conf")])]),t._v(" "),n("h3",{attrs:{id:"_8-1-nginx-配置语法"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_8-1-nginx-配置语法"}},[t._v("#")]),t._v(" 8.1 nginx 配置语法")]),t._v(" "),n("div",{staticClass:"language-bash extra-class"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 使用#可以添加注释,使用$符号可以使用变量")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 配置文件由指令与指令块组成,指令块以{}将多条指令组织在一起")]),t._v("\nhttp "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# include语句允许把多个配置文件组合起来以提升可维护性，也就是通过引入其他文件的方式")]),t._v("\n    include       /etc/nginx/mime.types"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#包含minme.types")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 每条指令以;(分号)结尾，指令与参数之间以空格分隔")]),t._v("\n    default_type  application/octet-stream"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    sendfile        on"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 打开零拷贝")]),t._v("\n    keepalive_timeout  "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("65")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 保持连接的超时时间")]),t._v("\n    include /etc/nginx/conf.d/*.conf"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 包含conf.d目录下的所有配置文件")]),t._v("\n    server "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 配置服务")]),t._v("\n        listen       "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("80")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 监听端口，默认监听80")]),t._v("\n        server_name  localhost"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 服务名字或域名或ip")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#charset koi8-r; # 俄语字符集")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 有些指令可以支持正则表达式")]),t._v("\n        location / "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            root   F:/dist"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 文件跟目录")]),t._v("\n            index  index.html index.htm"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 默认文件")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n        error_page  "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("404")]),t._v("              /404.html"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n        error_page   "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("500")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("502")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("503")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("504")]),t._v("  /50x.html"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 如果服务器返回的是500 就指向到500.html")]),t._v("\n        location "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" /50x.html "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            root   html"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),n("h3",{attrs:{id:"_8-2-全局配置"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_8-2-全局配置"}},[t._v("#")]),t._v(" 8.2 全局配置")]),t._v(" "),n("table",[n("thead",[n("tr",[n("th",[t._v("分类")]),t._v(" "),n("th",[t._v("配置项")]),t._v(" "),n("th",[t._v("作用")])])]),t._v(" "),n("tbody",[n("tr",[n("td",[t._v("全局")]),t._v(" "),n("td",[t._v("user")]),t._v(" "),n("td",[t._v("设置 nginx 服务的系统使用用户")])]),t._v(" "),n("tr",[n("td",[t._v("全局")]),t._v(" "),n("td",[t._v("worker_processes")]),t._v(" "),n("td",[t._v("工作进程数,一般和 CPU 数量相同")])]),t._v(" "),n("tr",[n("td",[t._v("全局")]),t._v(" "),n("td",[t._v("error_log")]),t._v(" "),n("td",[t._v("nginx 的错误日志")])]),t._v(" "),n("tr",[n("td",[t._v("全局")]),t._v(" "),n("td",[t._v("pid")]),t._v(" "),n("td",[t._v("nginx 服务启动时的 pid")])])])]),t._v(" "),n("h3",{attrs:{id:"_8-3-事件配置"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_8-3-事件配置"}},[t._v("#")]),t._v(" 8.3 事件配置")]),t._v(" "),n("table",[n("thead",[n("tr",[n("th",[t._v("分类")]),t._v(" "),n("th",[t._v("配置项")]),t._v(" "),n("th",[t._v("作用")])])]),t._v(" "),n("tbody",[n("tr",[n("td",[t._v("events")]),t._v(" "),n("td",[t._v("worker_connections")]),t._v(" "),n("td",[t._v("每个进程允许的最大连接数 10000")])]),t._v(" "),n("tr",[n("td",[t._v("events")]),t._v(" "),n("td",[t._v("use")]),t._v(" "),n("td",[t._v("指定使用哪种模型(select/poll/epoll),建议让 nginx 自动选择,linux 内核 2.6 以上一般能使用 epoll 可以提高性能")])])])]),t._v(" "),n("h3",{attrs:{id:"_8-4-http-配置"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_8-4-http-配置"}},[t._v("#")]),t._v(" 8.4 http 配置")]),t._v(" "),n("ul",[n("li",[t._v("/etc/nginx/nginx.conf")]),t._v(" "),n("li",[t._v("一个 HTTP 下面可以配置多个 server")])]),t._v(" "),n("div",{staticClass:"language-bash extra-class"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[t._v("user  nginx"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("   "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#设置nginx服务的系统使用用户")]),t._v("\nworker_processes  "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#工作进程数,一般和CPU数量相同")]),t._v("\n\nerror_log  /var/log/nginx/error.log warn"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("   "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#nginx的错误日志")]),t._v("\npid        /var/run/nginx.pid"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("   "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#nginx服务启动时的pid")]),t._v("\n\nevents "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    worker_connections  "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1024")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#每个进程允许的最大连接数 10000")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\nhttp "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    include       /etc/nginx/mime.types"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#文件后缀和类型类型的对应关系")]),t._v("\n    default_type  application/octet-stream"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#默认content-type")]),t._v("\n\n    log_format  main  "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'$remote_addr - $remote_user [$time_local] \"$request\" '")]),t._v("\n                      "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'$status $body_bytes_sent \"$http_referer\" '")]),t._v("\n                      "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('\'"$http_user_agent" "$http_x_forwarded_for"\'')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 日志记录格式")]),t._v("\n\n    access_log  /var/log/nginx/access.log  main"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#默认访问日志")]),t._v("\n\n    sendfile        on"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#启用sendfile")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#tcp_nopush     on; #懒发送")]),t._v("\n\n    keepalive_timeout  "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("65")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#超时时间是65秒")]),t._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#gzip  on; # 启用gzip压缩")]),t._v("\n\n    include /etc/nginx/conf.d/*.conf"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#包含的子配置文件")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),n("h3",{attrs:{id:"_8-5-server"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_8-5-server"}},[t._v("#")]),t._v(" 8.5 server")]),t._v(" "),n("ul",[n("li",[t._v("/etc/nginx/conf.d/default.conf")]),t._v(" "),n("li",[t._v("一个 server 下面可以配置多个 location")])]),t._v(" "),n("div",{staticClass:"language-bash extra-class"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[t._v("server "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    listen       "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("80")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#监听的端口号")]),t._v("\n    server_name  localhost"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#用域名方式访问的地址")]),t._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#charset koi8-r; //编码")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#access_log  /var/log/nginx/host.access.log  main; #访问日志文件和名称")]),t._v("\n\n    location / "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        root   /usr/share/nginx/html"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#静态文件根目录")]),t._v("\n        index  index.html index.htm"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#首页的索引文件")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#error_page  404              /404.html;  #指定错误页面")]),t._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# redirect server error pages to the static page /50x.html")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 把后台错误重定向到静态的50x.html页面")]),t._v("\n    error_page   "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("500")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("502")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("503")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("504")]),t._v("  /50x.html"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    location "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" /50x.html "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        root   /usr/share/nginx/html"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),n("h3",{attrs:{id:"_8-6-systemd"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_8-6-systemd"}},[t._v("#")]),t._v(" 8.6 Systemd")]),t._v(" "),n("ul",[n("li",[t._v("系统启动和服务器守护进程管理器，负责在系统启动或运行时，激活系统资源，服务器进程和其他进程，根据管理，字母 d 是守护进程（daemon）的缩写")])]),t._v(" "),n("h4",{attrs:{id:"_8-6-1-配置目录"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_8-6-1-配置目录"}},[t._v("#")]),t._v(" 8.6.1 配置目录")]),t._v(" "),n("table",[n("thead",[n("tr",[n("th",[t._v("配置目录")]),t._v(" "),n("th",[t._v("作用")])])]),t._v(" "),n("tbody",[n("tr",[n("td",[t._v("/usr/lib/systemd/system")]),t._v(" "),n("td",[t._v("每个服务最主要的启动脚本设置，类似于之前的/etc/initd.d")])]),t._v(" "),n("tr",[n("td",[t._v("/run/system/system")]),t._v(" "),n("td",[t._v("系统执行过程中所产生的服务脚本，比上面的目录优先运行")])]),t._v(" "),n("tr",[n("td",[t._v("/etc/system/system")]),t._v(" "),n("td",[t._v("管理员建立的执行脚本，类似于/etc/rc.d/rcN.d/Sxx 类的功能，比上面目录优先运行，在三者之中，此目录优先级最高")])])])]),t._v(" "),n("h4",{attrs:{id:"_8-6-2-systemctl"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_8-6-2-systemctl"}},[t._v("#")]),t._v(" 8.6.2 systemctl")]),t._v(" "),n("ul",[n("li",[t._v("监视和控制 systemd 的主要命令是 systemctl")]),t._v(" "),n("li",[t._v("该命令可用于查看系统状态和管理系统及服务")])]),t._v(" "),n("div",{staticClass:"language-bash extra-class"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 命令：")]),t._v("\nsystemctl  "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("command")]),t._v(" name.service\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 启动：")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("service")]),t._v(" name start –"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("systemctl start name.service\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 停止：")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("service")]),t._v(" name stop –"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("systemctl stop name.service\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 重启：")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("service")]),t._v(" name restart–"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("systemctl restart name.service\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 状态：")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("service")]),t._v(" name status–"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("systemctl status name.service\n")])])]),n("h3",{attrs:{id:"_8-7-启动和重新加载"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_8-7-启动和重新加载"}},[t._v("#")]),t._v(" 8.7 启动和重新加载")]),t._v(" "),n("div",{staticClass:"language-bash extra-class"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[t._v("systemctl restart nginx.service\nsystemctl reload nginx.service\nnginx -s reload\n")])])]),n("h3",{attrs:{id:"_8-8-日志类型"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_8-8-日志类型"}},[t._v("#")]),t._v(" 8.8 日志类型")]),t._v(" "),n("ul",[n("li",[n("code",[t._v("curl -v http://localhost")])])]),t._v(" "),n("h4",{attrs:{id:"_8-8-1-日志类型"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_8-8-1-日志类型"}},[t._v("#")]),t._v(" 8.8.1 日志类型")]),t._v(" "),n("ul",[n("li",[t._v("/var/log/nginx/access.log 访问日志")]),t._v(" "),n("li",[t._v("/var/log/nginx/error.log 错误日志")])]),t._v(" "),n("h4",{attrs:{id:"_8-8-2-log-format"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_8-8-2-log-format"}},[t._v("#")]),t._v(" 8.8.2 log_format")]),t._v(" "),n("table",[n("thead",[n("tr",[n("th",[t._v("类型")]),t._v(" "),n("th",[t._v("用法")])])]),t._v(" "),n("tbody",[n("tr",[n("td",[t._v("语法")]),t._v(" "),n("td",[t._v("log_format name [escape=default[json] string]")])]),t._v(" "),n("tr",[n("td",[t._v("默认")]),t._v(" "),n("td",[t._v('log_format combined " "')])]),t._v(" "),n("tr",[n("td",[t._v("Context")]),t._v(" "),n("td",[t._v("http")])])])]),t._v(" "),n("h5",{attrs:{id:"_8-8-2-1-内置变量"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_8-8-2-1-内置变量"}},[t._v("#")]),t._v(" 8.8.2.1 内置变量")]),t._v(" "),n("p",[n("RouterLink",{attrs:{to:"/nginx/config/'http://nginx.org/en/docs/http/ngx_http_log_module.html#log_format'"}},[t._v("ngx_http_log_module log_format")])],1),t._v(" "),n("table",[n("thead",[n("tr",[n("th",[t._v("名称")]),t._v(" "),n("th",[t._v("含义")])])]),t._v(" "),n("tbody",[n("tr",[n("td",[t._v("$remote_addr")]),t._v(" "),n("td",[t._v("客户端地址")])]),t._v(" "),n("tr",[n("td",[t._v("$remote_user")]),t._v(" "),n("td",[t._v("客户端用户名称")])]),t._v(" "),n("tr",[n("td",[t._v("$time_local")]),t._v(" "),n("td",[t._v("访问时间和时区")])]),t._v(" "),n("tr",[n("td",[t._v("$request")]),t._v(" "),n("td",[t._v("请求行")])]),t._v(" "),n("tr",[n("td",[t._v("$status")]),t._v(" "),n("td",[t._v("HTTP 请求状态")])]),t._v(" "),n("tr",[n("td",[t._v("$body_bytes_sent")]),t._v(" "),n("td",[t._v("发送给客户端文件内容大小")])])])]),t._v(" "),n("h5",{attrs:{id:"_8-8-2-2-http-请求变量"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_8-8-2-2-http-请求变量"}},[t._v("#")]),t._v(" 8.8.2.2 HTTP 请求变量")]),t._v(" "),n("ul",[n("li",[t._v("注意要把-转成下划线,比如 User-Agent 对应于$http_user_agent")])]),t._v(" "),n("table",[n("thead",[n("tr",[n("th",[t._v("名称")]),t._v(" "),n("th",[t._v("作用")]),t._v(" "),n("th",[t._v("例子")])])]),t._v(" "),n("tbody",[n("tr",[n("td",[t._v("arg_PARAMETER")]),t._v(" "),n("td",[t._v("请求参数")]),t._v(" "),n("td",[t._v("$arg_name")])]),t._v(" "),n("tr",[n("td",[t._v("http_HEADER")]),t._v(" "),n("td",[t._v("请求头")]),t._v(" "),n("td",[t._v("$http_referer $http_host $http_user_agent $http_x_forwarded_for(代理过程)")])]),t._v(" "),n("tr",[n("td",[t._v("sent_http_HEADER")]),t._v(" "),n("td",[t._v("响应头")]),t._v(" "),n("td",[t._v("sent_http_cookie")])])])]),t._v(" "),n("ul",[n("li",[n("p",[t._v("IP1->IP2(代理)->IP3 会记录 IP 地址的代理过程")]),t._v(" "),n("ul",[n("li",[t._v("http_x_forwarded_for=Client IP,Proxy(1) IP,Proxy(2) IP")])])])]),t._v(" "),n("p",[t._v("例")]),t._v(" "),n("div",{staticClass:"language-bash extra-class"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 定义一种日志格式")]),t._v("\n log_format  main  "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'$remote_addr - $remote_user [$time_local] \"$request\" '")]),t._v("\n                      "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'$status $body_bytes_sent \"$http_referer\" '")]),t._v("\n                      "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('\'"$http_user_agent" "$http_x_forwarded_for"\'')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n log_format  zfpx  "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'$arg_name $http_referer sent_http_date\"'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 指定写入的文件名和日志格式")]),t._v("\n access_log  /var/log/nginx/access.log  main"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),n("div",{staticClass:"language-bash extra-class"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token function"}},[t._v("tail")]),t._v(" -f /var/log/nginx/access.log\n\n"),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("10.10")]),t._v(".18.150 - - "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("30")]),t._v("/Dec/2021:21:54:45 -0500"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"GET / HTTP/1.1"')]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("200")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("4057")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"-"')]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/96.0.4664.110 Safari/537.36"')]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"-"')]),t._v("\n")])])]),n("h2",{attrs:{id:"_9-nginx-工作流"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_9-nginx-工作流"}},[t._v("#")]),t._v(" 9.nginx 工作流")]),t._v(" "),n("h3",{attrs:{id:"_9-1-配置块"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_9-1-配置块"}},[t._v("#")]),t._v(" 9.1 配置块")]),t._v(" "),n("ul",[n("li",[t._v("请求到来时先按域名找到 server 块")]),t._v(" "),n("li",[t._v("再按请求路径找到 location 块")]),t._v(" "),n("li",[t._v("Context 是指本指令出现在哪个块内")])]),t._v(" "),n("h3",{attrs:{id:"_9-2-值指令继承规则"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_9-2-值指令继承规则"}},[t._v("#")]),t._v(" 9.2 值指令继承规则")]),t._v(" "),n("ul",[n("li",[t._v("值指令可以合并，动作类指令不可以合并")]),t._v(" "),n("li",[t._v("值指令是向上覆盖的，子配置不存在，可以使用父配置块的指令，如果子指令存在，会覆盖父配置块中的指令")])]),t._v(" "),n("div",{staticClass:"language-bash extra-class"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[t._v("server "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    listen "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("80")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    root /home/nginx/html"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    access_log logs/access.log main"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    location /image"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n       access_log logs/access.log image"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    location /video"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),n("h3",{attrs:{id:"_9-3-server-匹配"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_9-3-server-匹配"}},[t._v("#")]),t._v(" 9.3 server 匹配")]),t._v(" "),n("ul",[n("li",[t._v("精确匹配")]),t._v(" "),n("li",[t._v("*在前")]),t._v(" "),n("li",[t._v("*在后")]),t._v(" "),n("li",[t._v("按文件中的顺序匹配正则式域名")]),t._v(" "),n("li",[t._v("default server")])]),t._v(" "),n("h3",{attrs:{id:"_9-4-http-请求处理"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_9-4-http-请求处理"}},[t._v("#")]),t._v(" 9.4 HTTP 请求处理")]),t._v(" "),n("p",[n("img",{attrs:{src:a(183),alt:"请求处理"}})]),t._v(" "),n("table",[n("thead",[n("tr",[n("th",[t._v("阶段")]),t._v(" "),n("th",[t._v("名称")]),t._v(" "),n("th",[t._v("对应模块")])])]),t._v(" "),n("tbody",[n("tr",[n("td",[t._v("读取请求后")]),t._v(" "),n("td",[t._v("POST_READ")]),t._v(" "),n("td",[t._v("realip")])]),t._v(" "),n("tr",[n("td",[t._v("重写")]),t._v(" "),n("td",[t._v("SERVER_REWRITE")]),t._v(" "),n("td",[t._v("rewrite")])]),t._v(" "),n("tr",[n("td",[t._v("匹配 location")]),t._v(" "),n("td",[t._v("FIND_CONFIG")]),t._v(" "),n("td",[t._v("rewrite")])]),t._v(" "),n("tr",[n("td",[t._v("重写")]),t._v(" "),n("td",[t._v("REWRITE")]),t._v(" "),n("td",[t._v("rewrite")])]),t._v(" "),n("tr",[n("td",[t._v("重写后")]),t._v(" "),n("td",[t._v("POST_REWRITE")]),t._v(" "),n("td")]),t._v(" "),n("tr",[n("td",[t._v("访问前限制")]),t._v(" "),n("td",[t._v("PREACCESS")]),t._v(" "),n("td",[t._v("limit_conn,limit_req")])]),t._v(" "),n("tr",[n("td",[t._v("是否有权限访问")]),t._v(" "),n("td",[t._v("ACCESS")]),t._v(" "),n("td",[t._v("auth_basic,access,auth_request")])]),t._v(" "),n("tr",[n("td",[t._v("判断权限后")]),t._v(" "),n("td",[t._v("POST_ACCESS")]),t._v(" "),n("td")]),t._v(" "),n("tr",[n("td",[t._v("响应前")]),t._v(" "),n("td",[t._v("PRECONTENT")]),t._v(" "),n("td",[t._v("try_files")])]),t._v(" "),n("tr",[n("td",[t._v("读取请求后")]),t._v(" "),n("td",[t._v("CONTENT")]),t._v(" "),n("td",[t._v("index,autoindex,concat")])]),t._v(" "),n("tr",[n("td",[t._v("打印日志")]),t._v(" "),n("td",[t._v("LOG")]),t._v(" "),n("td",[t._v("access_log")])])])])])}),[],!1,null,null,null);s.default=e.exports}}]);