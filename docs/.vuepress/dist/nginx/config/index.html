<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Nginx | 前端运维</title>
    <meta name="generator" content="VuePress 1.9.7">
    <link rel="icon" href="https://vuejs.org/images/logo.png">
    <meta name="description" content="linux、nginx、docker、持续集成、k8s">
    
    <link rel="preload" href="/FE_OPS/assets/css/0.styles.a6e8606b.css" as="style"><link rel="preload" href="/FE_OPS/assets/js/app.00b3f334.js" as="script"><link rel="preload" href="/FE_OPS/assets/js/2.52b9351e.js" as="script"><link rel="preload" href="/FE_OPS/assets/js/7.ef58fabf.js" as="script"><link rel="prefetch" href="/FE_OPS/assets/js/10.cf2d6a62.js"><link rel="prefetch" href="/FE_OPS/assets/js/11.0ed17998.js"><link rel="prefetch" href="/FE_OPS/assets/js/12.4f4e2c3f.js"><link rel="prefetch" href="/FE_OPS/assets/js/13.6975663a.js"><link rel="prefetch" href="/FE_OPS/assets/js/14.5dc4cad6.js"><link rel="prefetch" href="/FE_OPS/assets/js/15.c369746b.js"><link rel="prefetch" href="/FE_OPS/assets/js/16.e2d1670e.js"><link rel="prefetch" href="/FE_OPS/assets/js/17.610e2c4c.js"><link rel="prefetch" href="/FE_OPS/assets/js/18.ab590110.js"><link rel="prefetch" href="/FE_OPS/assets/js/19.36b81dfb.js"><link rel="prefetch" href="/FE_OPS/assets/js/20.89f9143a.js"><link rel="prefetch" href="/FE_OPS/assets/js/21.6d57371e.js"><link rel="prefetch" href="/FE_OPS/assets/js/22.b34f833f.js"><link rel="prefetch" href="/FE_OPS/assets/js/23.db2c9f97.js"><link rel="prefetch" href="/FE_OPS/assets/js/24.f036be3b.js"><link rel="prefetch" href="/FE_OPS/assets/js/25.f703d930.js"><link rel="prefetch" href="/FE_OPS/assets/js/26.b5a6e88e.js"><link rel="prefetch" href="/FE_OPS/assets/js/3.2260921c.js"><link rel="prefetch" href="/FE_OPS/assets/js/4.0c064d44.js"><link rel="prefetch" href="/FE_OPS/assets/js/5.96777648.js"><link rel="prefetch" href="/FE_OPS/assets/js/6.fa8f1b25.js"><link rel="prefetch" href="/FE_OPS/assets/js/8.fd3833a2.js"><link rel="prefetch" href="/FE_OPS/assets/js/9.278b10da.js">
    <link rel="stylesheet" href="/FE_OPS/assets/css/0.styles.a6e8606b.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/FE_OPS/" class="home-link router-link-active"><img src="https://vuejs.org/images/logo.png" alt="前端运维" class="logo"> <span class="site-name can-hide">前端运维</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/FE_OPS/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/FE_OPS/guide/" class="nav-link">
  Guide
</a></div><div class="nav-item"><a href="https://github.com/leiyangs" target="_blank" rel="noopener noreferrer" class="nav-link external">
  github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/FE_OPS/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/FE_OPS/guide/" class="nav-link">
  Guide
</a></div><div class="nav-item"><a href="https://github.com/leiyangs" target="_blank" rel="noopener noreferrer" class="nav-link external">
  github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Linux</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Nginx</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/FE_OPS/nginx/config/" aria-current="page" class="active sidebar-link">nginx安装/配置</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/FE_OPS/nginx/config/#_1-nginx-使用场景" class="sidebar-link">1. nginx 使用场景</a></li><li class="sidebar-sub-header"><a href="/FE_OPS/nginx/config/#_2-nginx-的优点" class="sidebar-link">2. nginx 的优点</a></li><li class="sidebar-sub-header"><a href="/FE_OPS/nginx/config/#_3-使用" class="sidebar-link">3. 使用</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/FE_OPS/nginx/config/#_3-1-关闭防火墙" class="sidebar-link">3.1 关闭防火墙</a></li><li class="sidebar-sub-header"><a href="/FE_OPS/nginx/config/#_3-2-确认停用-selinux" class="sidebar-link">3.2 确认停用 selinux</a></li><li class="sidebar-sub-header"><a href="/FE_OPS/nginx/config/#_3-3-安装依赖模块" class="sidebar-link">3.3 安装依赖模块</a></li></ul></li><li class="sidebar-sub-header"><a href="/FE_OPS/nginx/config/#_4-nginx-的架构" class="sidebar-link">4. nginx 的架构</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/FE_OPS/nginx/config/#_4-1-轻量" class="sidebar-link">4.1 轻量</a></li><li class="sidebar-sub-header"><a href="/FE_OPS/nginx/config/#_4-2-架构" class="sidebar-link">4.2 架构</a></li><li class="sidebar-sub-header"><a href="/FE_OPS/nginx/config/#_4-2-1-工作流程" class="sidebar-link" style="padding-left:3rem;">4.2.1 工作流程</a></li><li class="sidebar-sub-header"><a href="/FE_OPS/nginx/config/#_4-2-2-io-多路复用" class="sidebar-link" style="padding-left:3rem;">4.2.2 IO 多路复用</a></li><li class="sidebar-sub-header"><a href="/FE_OPS/nginx/config/#_4-2-4-cpu-亲和" class="sidebar-link" style="padding-left:3rem;">4.2.4 CPU 亲和</a></li><li class="sidebar-sub-header"><a href="/FE_OPS/nginx/config/#_4-2-5-sendfile" class="sidebar-link" style="padding-left:3rem;">4.2.5 sendfile</a></li></ul></li><li class="sidebar-sub-header"><a href="/FE_OPS/nginx/config/#_5-安装" class="sidebar-link">5. 安装</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/FE_OPS/nginx/config/#_5-1-版本" class="sidebar-link">5.1 版本</a></li><li class="sidebar-sub-header"><a href="/FE_OPS/nginx/config/#_5-2-下载地址" class="sidebar-link">5.2 下载地址</a></li><li class="sidebar-sub-header"><a href="/FE_OPS/nginx/config/#_5-3-centos-下-yum-安装" class="sidebar-link">5.3 CentOS 下 YUM 安装</a></li></ul></li><li class="sidebar-sub-header"><a href="/FE_OPS/nginx/config/#_6-目录" class="sidebar-link">6. 目录</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/FE_OPS/nginx/config/#_6-1-安装目录" class="sidebar-link">6.1 安装目录</a></li><li class="sidebar-sub-header"><a href="/FE_OPS/nginx/config/#_6-2-日志切割文件" class="sidebar-link">6.2 日志切割文件</a></li><li class="sidebar-sub-header"><a href="/FE_OPS/nginx/config/#_6-3-主配置文件" class="sidebar-link">6.3 主配置文件</a></li><li class="sidebar-sub-header"><a href="/FE_OPS/nginx/config/#_6-4-守护进程管理" class="sidebar-link">6.4 守护进程管理</a></li><li class="sidebar-sub-header"><a href="/FE_OPS/nginx/config/#_6-5-nginx-模块目录" class="sidebar-link">6.5 nginx 模块目录</a></li><li class="sidebar-sub-header"><a href="/FE_OPS/nginx/config/#_6-6-文档" class="sidebar-link">6.6 文档</a></li><li class="sidebar-sub-header"><a href="/FE_OPS/nginx/config/#_6-7-缓存目录" class="sidebar-link">6.7 缓存目录</a></li><li class="sidebar-sub-header"><a href="/FE_OPS/nginx/config/#_6-8-日志目录" class="sidebar-link">6.8 日志目录</a></li><li class="sidebar-sub-header"><a href="/FE_OPS/nginx/config/#_6-9-可执行命令" class="sidebar-link">6.9 可执行命令</a></li></ul></li><li class="sidebar-sub-header"><a href="/FE_OPS/nginx/config/#_7-编译参数" class="sidebar-link">7. 编译参数</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/FE_OPS/nginx/config/#_7-1-安装目录和路径" class="sidebar-link">7.1 安装目录和路径</a></li><li class="sidebar-sub-header"><a href="/FE_OPS/nginx/config/#_7-2-指定用户" class="sidebar-link">7.2 指定用户</a></li></ul></li><li class="sidebar-sub-header"><a href="/FE_OPS/nginx/config/#_8-配置文件" class="sidebar-link">8. 配置文件</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/FE_OPS/nginx/config/#_8-1-nginx-配置语法" class="sidebar-link">8.1 nginx 配置语法</a></li><li class="sidebar-sub-header"><a href="/FE_OPS/nginx/config/#_8-2-全局配置" class="sidebar-link">8.2 全局配置</a></li><li class="sidebar-sub-header"><a href="/FE_OPS/nginx/config/#_8-3-事件配置" class="sidebar-link">8.3 事件配置</a></li><li class="sidebar-sub-header"><a href="/FE_OPS/nginx/config/#_8-4-http-配置" class="sidebar-link">8.4 http 配置</a></li><li class="sidebar-sub-header"><a href="/FE_OPS/nginx/config/#_8-5-server" class="sidebar-link">8.5 server</a></li><li class="sidebar-sub-header"><a href="/FE_OPS/nginx/config/#_8-6-systemd" class="sidebar-link">8.6 Systemd</a></li><li class="sidebar-sub-header"><a href="/FE_OPS/nginx/config/#_8-6-1-配置目录" class="sidebar-link" style="padding-left:3rem;">8.6.1 配置目录</a></li><li class="sidebar-sub-header"><a href="/FE_OPS/nginx/config/#_8-6-2-systemctl" class="sidebar-link" style="padding-left:3rem;">8.6.2 systemctl</a></li><li class="sidebar-sub-header"><a href="/FE_OPS/nginx/config/#_8-7-启动和重新加载" class="sidebar-link">8.7 启动和重新加载</a></li><li class="sidebar-sub-header"><a href="/FE_OPS/nginx/config/#_8-8-日志类型" class="sidebar-link">8.8 日志类型</a></li><li class="sidebar-sub-header"><a href="/FE_OPS/nginx/config/#_8-8-1-日志类型" class="sidebar-link" style="padding-left:3rem;">8.8.1 日志类型</a></li><li class="sidebar-sub-header"><a href="/FE_OPS/nginx/config/#_8-8-2-log-format" class="sidebar-link" style="padding-left:3rem;">8.8.2 log_format</a></li><li class="sidebar-sub-header"><a href="/FE_OPS/nginx/config/#_8-8-2-1-内置变量" class="sidebar-link" style="padding-left:4rem;">8.8.2.1 内置变量</a></li><li class="sidebar-sub-header"><a href="/FE_OPS/nginx/config/#_8-8-2-2-http-请求变量" class="sidebar-link" style="padding-left:4rem;">8.8.2.2 HTTP 请求变量</a></li></ul></li><li class="sidebar-sub-header"><a href="/FE_OPS/nginx/config/#_9-nginx-工作流" class="sidebar-link">9.nginx 工作流</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/FE_OPS/nginx/config/#_9-1-配置块" class="sidebar-link">9.1 配置块</a></li><li class="sidebar-sub-header"><a href="/FE_OPS/nginx/config/#_9-2-值指令继承规则" class="sidebar-link">9.2 值指令继承规则</a></li><li class="sidebar-sub-header"><a href="/FE_OPS/nginx/config/#_9-3-server-匹配" class="sidebar-link">9.3 server 匹配</a></li><li class="sidebar-sub-header"><a href="/FE_OPS/nginx/config/#_9-4-http-请求处理" class="sidebar-link">9.4 HTTP 请求处理</a></li></ul></li></ul></li><li><a href="/FE_OPS/nginx/core/" class="sidebar-link">nginx核心</a></li><li><a href="/FE_OPS/nginx/static/" class="sidebar-link">静态资源服务</a></li><li><a href="/FE_OPS/nginx/crossDomain/" class="sidebar-link">跨域</a></li><li><a href="/FE_OPS/nginx/proxy/" class="sidebar-link">代理服务</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Docker</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>CICD</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>K8s</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="nginx"><a href="#nginx" class="header-anchor">#</a> Nginx</h1> <p>Nginx (engine x) 是一个高性能的 HTTP 和反向代理 web 服务器，同时也提供了 IMAP/POP3/SMTP 服务。Nginx 是由伊戈尔·赛索耶夫为俄罗斯访问量第二的 Rambler.ru 站点（俄文：Рамблер）开发的，第一个公开版本 0.1.0 发布于 2004 年 10 月 4 日。</p> <h2 id="_1-nginx-使用场景"><a href="#_1-nginx-使用场景" class="header-anchor">#</a> 1. nginx 使用场景</h2> <ul><li>静态资源服务器</li> <li>反向代理服务</li> <li>API 接口服务(Lua&amp;Javascript)</li></ul> <h2 id="_2-nginx-的优点"><a href="#_2-nginx-的优点" class="header-anchor">#</a> 2. nginx 的优点</h2> <ul><li>高并发高性能 (几十万无压力)</li> <li>可扩展性好 (内核精简，可进行二次编程)</li> <li>高可靠性 (很稳定)</li> <li>热布署 (不需要重启)</li> <li>开源许可证 (免费开源)</li></ul> <h2 id="_3-使用"><a href="#_3-使用" class="header-anchor">#</a> 3. 使用</h2> <h3 id="_3-1-关闭防火墙"><a href="#_3-1-关闭防火墙" class="header-anchor">#</a> 3.1 关闭防火墙</h3> <table><thead><tr><th>命令</th> <th>作用</th></tr></thead> <tbody><tr><td>systemctl stop firewalld.service</td> <td>停止防火墙</td></tr> <tr><td>systemctl disable firewalld.service</td> <td>永久关闭防火墙</td></tr></tbody></table> <h3 id="_3-2-确认停用-selinux"><a href="#_3-2-确认停用-selinux" class="header-anchor">#</a> 3.2 确认停用 selinux</h3> <ul><li>安全增强型 Linux（Security-Enhanced Linux）简称 SELinux，它是一个 Linux 内核模块，也是 Linux 的一个安全子系统。</li> <li>SELinux 主要作用就是最大限度地减小系统中服务进程可访问的资源（最小权限原则）。</li></ul> <table><thead><tr><th>命令</th> <th>作用</th></tr></thead> <tbody><tr><td>getenforce</td> <td>检查状态</td></tr> <tr><td>/usr/sbin/sestatus -v</td> <td>检查状态</td></tr> <tr><td>setenforce 0</td> <td>临时关闭</td></tr> <tr><td>/etc/selinux/config SELINUX=enforcing 改为 SELINUX=disabled</td> <td>永久关闭</td></tr></tbody></table> <h3 id="_3-3-安装依赖模块"><a href="#_3-3-安装依赖模块" class="header-anchor">#</a> 3.3 安装依赖模块</h3> <div class="language-bash extra-class"><pre class="language-bash"><code>yum  -y <span class="token function">install</span> gcc gcc-c++ autoconf pcre pcre-devel <span class="token function">make</span> automake openssl openssl-devel
</code></pre></div><table><thead><tr><th>软件包</th> <th>描述</th></tr></thead> <tbody><tr><td>gcc</td> <td>gcc 是指整个 gcc 的这一套工具集合，它分为 gcc 前端和 gcc 后端（我个人理解为 gcc 外壳和 gcc 引擎），gcc 前端对应各种特定语言（如 c++/go 等）的处理（对 c++/go 等特定语言进行对应的语法检查, 将 c++/go 等语言的代码转化为 c 代码等），gcc 后端对应把前端的 c 代码转为跟你的电脑硬件相关的汇编或机器码</td></tr> <tr><td>gcc-c++</td> <td>而就软件程序包而言，gcc.rpm 就是那个 gcc 后端，而 gcc-c++.rpm 就是针对 c++这个特定语言的 gcc 前端</td></tr> <tr><td>autoconf</td> <td>autoconf 是一个软件包，以适应多种 Unix 类系统的 shell 脚本的工具</td></tr> <tr><td>pcre</td> <td>PCRE(Perl Compatible Regular Expressions)是一个 Perl 库，包括 perl 兼容的正则表达式库</td></tr> <tr><td>pcre-devel</td> <td>devel 包主要是供开发用,包含头文件和链接库</td></tr> <tr><td>make</td> <td>常指一条计算机指令，是在安装有 GNU Make 的计算机上的可执行指令。该指令是读入一个名为 makefile 的文件，然后执行这个文件中指定的指令</td></tr> <tr><td>automake</td> <td>automake 可以用来帮助我们自动地生成符合自由软件惯例的 Makefile</td></tr> <tr><td>wget</td> <td>wget 是一个从网络上自动下载文件的自由工具，支持通过 HTTP、HTTPS、FTP 三个最常见的 TCP/IP 协议 下载，并可以使用 HTTP 代理</td></tr> <tr><td>httpd-tools</td> <td>apace 压力测试</td></tr> <tr><td>vim</td> <td>Vim 是一个类似于 Vi 的著名的功能强大、高度可定制的文本编辑器</td></tr></tbody></table> <table><thead><tr><th>目录名</th> <th>含义</th></tr></thead> <tbody><tr><td>app</td> <td>存放代码和应用</td></tr> <tr><td>backup</td> <td>存放备份的文件</td></tr> <tr><td>download</td> <td>下载下来的代码和安装包</td></tr> <tr><td>logs</td> <td>放日志的</td></tr> <tr><td>work</td> <td>工作目录</td></tr></tbody></table> <h2 id="_4-nginx-的架构"><a href="#_4-nginx-的架构" class="header-anchor">#</a> 4. nginx 的架构</h2> <h3 id="_4-1-轻量"><a href="#_4-1-轻量" class="header-anchor">#</a> 4.1 轻量</h3> <ul><li>源代码只包含核心模块</li> <li>其它非核心功能都是通过模块实现，可以自由选择</li></ul> <h3 id="_4-2-架构"><a href="#_4-2-架构" class="header-anchor">#</a> 4.2 架构</h3> <ul><li>Nginx 采用的是多进程(单线程)和多路 IO 复用模型</li></ul> <h4 id="_4-2-1-工作流程"><a href="#_4-2-1-工作流程" class="header-anchor">#</a> 4.2.1 工作流程</h4> <ul><li>Nginx 在启动后，会有一个 master 进程和多个相互独立的 worker 进程。</li> <li>接收来自外界的信号,向各 worker 进程发送信号,每个进程都有可能来处理这个连接。</li> <li>master 进程能监控 worker 进程的运行状态，当 worker 进程退出后(异常情况下)，会自动启动新的 worker 进程。</li> <li>worker 进程数，一般会设置成机器 cpu 核数。因为更多的 worker 数，只会导致进程相互竞争 cpu，从而带来不必要的上下文切换</li> <li>使用多进程模式，不仅能提高并发率，而且进程之间相互独立，一个 worker 进程挂了不会影响到其他 worker 进程</li></ul> <h4 id="_4-2-2-io-多路复用"><a href="#_4-2-2-io-多路复用" class="header-anchor">#</a> 4.2.2 IO 多路复用</h4> <ul><li>多个文件描述符的 IO 操作都能在一个线程里并发交替顺序完成，复用线程</li></ul> <h4 id="_4-2-4-cpu-亲和"><a href="#_4-2-4-cpu-亲和" class="header-anchor">#</a> 4.2.4 CPU 亲和</h4> <ul><li>把 CPU 内核和 nginx 的工作进程绑定在一起，让每个 worker 进程固定在一个 CPU 上执行，从而减少 CPU 的切换并提高缓存命中率，提高 性能</li></ul> <h4 id="_4-2-5-sendfile"><a href="#_4-2-5-sendfile" class="header-anchor">#</a> 4.2.5 sendfile</h4> <ul><li>sendfile 零拷贝传输模式</li></ul> <h2 id="_5-安装"><a href="#_5-安装" class="header-anchor">#</a> 5. 安装</h2> <h3 id="_5-1-版本"><a href="#_5-1-版本" class="header-anchor">#</a> 5.1 版本</h3> <ul><li>Mainline version 开发版</li> <li>Stable version 稳定版</li> <li>Legacy versions 历史版本</li></ul> <h3 id="_5-2-下载地址"><a href="#_5-2-下载地址" class="header-anchor">#</a> 5.2 下载地址</h3> <ul><li><a href="http://nginx.org/en/download.html" target="_blank" rel="noopener noreferrer">下载地址<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="http://nginx.org/en/linux_packages.html#stable" target="_blank" rel="noopener noreferrer">linux_packages<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul> <h3 id="_5-3-centos-下-yum-安装"><a href="#_5-3-centos-下-yum-安装" class="header-anchor">#</a> 5.3 CentOS 下 YUM 安装</h3> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># 添加安装源</span>
<span class="token function">vi</span> /etc/yum.repos.d/nginx.repo

<span class="token comment"># 写入内容</span>
<span class="token punctuation">[</span>nginx<span class="token punctuation">]</span>
<span class="token assign-left variable">name</span><span class="token operator">=</span>nginx repo
<span class="token assign-left variable">baseurl</span><span class="token operator">=</span>http://nginx.org/packages/centos/7/<span class="token variable">$basearch</span>/
<span class="token assign-left variable">gpgcheck</span><span class="token operator">=</span><span class="token number">0</span>
<span class="token assign-left variable">enabled</span><span class="token operator">=</span><span class="token number">1</span>

<span class="token comment">#下载</span>
yum <span class="token function">install</span> nginx -y <span class="token comment"># 安装nginx</span>
nginx -v <span class="token comment"># 查看安装的版本</span>
nginx -V <span class="token comment"># 查看编译时的参数</span>
</code></pre></div><h2 id="_6-目录"><a href="#_6-目录" class="header-anchor">#</a> 6. 目录</h2> <h3 id="_6-1-安装目录"><a href="#_6-1-安装目录" class="header-anchor">#</a> 6.1 安装目录</h3> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># 查看nginx安装的配置文件和目录</span>
<span class="token function">rpm</span> -ql nginx
</code></pre></div><h3 id="_6-2-日志切割文件"><a href="#_6-2-日志切割文件" class="header-anchor">#</a> 6.2 日志切割文件</h3> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># 查看日志配置</span>
<span class="token function">cat</span> /etc/logrotate.d/nginx

<span class="token comment"># 对访问日志进行切割</span>
<span class="token comment"># 每天都生成一个日志文件，就是所谓的日志切割</span>
/var/log/nginx/*.log <span class="token punctuation">{</span>
  daily
<span class="token punctuation">}</span>

<span class="token comment"># 查看所有的log文件</span>
<span class="token function">ls</span> /var/log/nginx/*.log
</code></pre></div><h3 id="_6-3-主配置文件"><a href="#_6-3-主配置文件" class="header-anchor">#</a> 6.3 主配置文件</h3> <table><thead><tr><th>路径</th> <th>概念</th></tr></thead> <tbody><tr><td>/etc/nginx/nginx.conf</td> <td>核心配置文件</td></tr> <tr><td>/etc/nginx/conf.d/default.conf</td> <td>默认 http 服务器配置文件</td></tr></tbody></table> <h3 id="_6-4-守护进程管理"><a href="#_6-4-守护进程管理" class="header-anchor">#</a> 6.4 守护进程管理</h3> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># 用于配置系统守护进程管理器管理方式</span>
systemctl restart nginx.service
</code></pre></div><h3 id="_6-5-nginx-模块目录"><a href="#_6-5-nginx-模块目录" class="header-anchor">#</a> 6.5 nginx 模块目录</h3> <table><thead><tr><th>路径</th> <th>概念</th></tr></thead> <tbody><tr><td>/etc/nginx/modules</td> <td>最基本的共享库和内核模块</td></tr></tbody></table> <p>nginx 的安装模块，目的是存放用于启动系统和执行 root 文件系统的命令的如/bin 和/sbin 的二进制文件的共享库，或者存放 32 位，或者 64 位(file 命令查看)| | /usr/lib64/nginx/modules |64 位共享库|</p> <h3 id="_6-6-文档"><a href="#_6-6-文档" class="header-anchor">#</a> 6.6 文档</h3> <p>nginx 的手册和帮助文件</p> <table><thead><tr><th>路径</th> <th>概念</th></tr></thead> <tbody><tr><td>/usr/share/doc/nginx-1.14.2</td> <td>帮助文档</td></tr> <tr><td>/usr/share/doc/nginx-1.14.0/COPYRIGHT</td> <td>版权声明</td></tr> <tr><td>/usr/share/man/man8/nginx.8.gz</td> <td>手册</td></tr></tbody></table> <h3 id="_6-7-缓存目录"><a href="#_6-7-缓存目录" class="header-anchor">#</a> 6.7 缓存目录</h3> <table><thead><tr><th>路径</th> <th>概念</th></tr></thead> <tbody><tr><td>/var/cache/nginx</td> <td>nginx 的缓存目录</td></tr></tbody></table> <h3 id="_6-8-日志目录"><a href="#_6-8-日志目录" class="header-anchor">#</a> 6.8 日志目录</h3> <table><thead><tr><th>路径</th> <th>概念</th></tr></thead> <tbody><tr><td>/var/log/nginx</td> <td>nginx 的日志目录</td></tr></tbody></table> <h3 id="_6-9-可执行命令"><a href="#_6-9-可执行命令" class="header-anchor">#</a> 6.9 可执行命令</h3> <p>nginx 服务的启动管理的可执行文件（重要）</p> <table><thead><tr><th>路径</th> <th>概念</th></tr></thead> <tbody><tr><td>/usr/sbin/nginx</td> <td>可执行命令</td></tr> <tr><td>/usr/sbin/nginx-debug</td> <td>调试执行可执行命令</td></tr></tbody></table> <h2 id="_7-编译参数"><a href="#_7-编译参数" class="header-anchor">#</a> 7. 编译参数</h2> <h3 id="_7-1-安装目录和路径"><a href="#_7-1-安装目录和路径" class="header-anchor">#</a> 7.1 安装目录和路径</h3> <div class="language-bash extra-class"><pre class="language-bash"><code>--prefix<span class="token operator">=</span>/etc/nginx //安装目录
--sbin-path<span class="token operator">=</span>/usr/sbin/nginx //可执行文件
--modules-path<span class="token operator">=</span>/usr/lib64/nginx/modules //安装模块
--conf-path<span class="token operator">=</span>/etc/nginx/nginx.conf  //配置文件路径
--error-log-path<span class="token operator">=</span>/var/log/nginx/error.log  //错误日志
--http-log-path<span class="token operator">=</span>/var/log/nginx/access.log  //访问日志
--pid-path<span class="token operator">=</span>/var/run/nginx.pid //进程ID
--lock-path<span class="token operator">=</span>/var/run/nginx.lock //加锁对象
</code></pre></div><h3 id="_7-2-指定用户"><a href="#_7-2-指定用户" class="header-anchor">#</a> 7.2 指定用户</h3> <ul><li>配置 nginx 进程启动的用户和用户组</li></ul> <div class="language-bash extra-class"><pre class="language-bash"><code>--user<span class="token operator">=</span>nginx   <span class="token comment">#指定用户</span>
--group<span class="token operator">=</span>nginx  <span class="token comment">#指定用户组</span>
</code></pre></div><h2 id="_8-配置文件"><a href="#_8-配置文件" class="header-anchor">#</a> 8. 配置文件</h2> <ul><li>/etc/nginx/nginx.conf #主配置文件</li> <li>/etc/nginx/conf.d/*.conf #包含 conf.d 目录下面的所有配置文件</li> <li>/etc/nginx/conf.d/default.conf</li></ul> <h3 id="_8-1-nginx-配置语法"><a href="#_8-1-nginx-配置语法" class="header-anchor">#</a> 8.1 nginx 配置语法</h3> <div class="language-bash extra-class"><pre class="language-bash"><code>
<span class="token comment"># 使用#可以添加注释,使用$符号可以使用变量</span>
<span class="token comment"># 配置文件由指令与指令块组成,指令块以{}将多条指令组织在一起</span>
http <span class="token punctuation">{</span>
    <span class="token comment"># include语句允许把多个配置文件组合起来以提升可维护性，也就是通过引入其他文件的方式</span>
    include       /etc/nginx/mime.types<span class="token punctuation">;</span> <span class="token comment">#包含minme.types</span>
    <span class="token comment"># 每条指令以;(分号)结尾，指令与参数之间以空格分隔</span>
    default_type  application/octet-stream<span class="token punctuation">;</span>
    sendfile        on<span class="token punctuation">;</span> <span class="token comment"># 打开零拷贝</span>
    keepalive_timeout  <span class="token number">65</span><span class="token punctuation">;</span> <span class="token comment"># 保持连接的超时时间</span>
    include /etc/nginx/conf.d/*.conf<span class="token punctuation">;</span> <span class="token comment"># 包含conf.d目录下的所有配置文件</span>
    server <span class="token punctuation">{</span> <span class="token comment"># 配置服务</span>
        listen       <span class="token number">80</span><span class="token punctuation">;</span> <span class="token comment"># 监听端口，默认监听80</span>
        server_name  localhost<span class="token punctuation">;</span> <span class="token comment"># 服务名字或域名或ip</span>
        <span class="token comment">#charset koi8-r; # 俄语字符集</span>
        <span class="token comment"># 有些指令可以支持正则表达式</span>
        location / <span class="token punctuation">{</span>
            root   F:/dist<span class="token punctuation">;</span> <span class="token comment"># 文件跟目录</span>
            index  index.html index.htm<span class="token punctuation">;</span> <span class="token comment"># 默认文件</span>
        <span class="token punctuation">}</span>

        error_page  <span class="token number">404</span>              /404.html<span class="token punctuation">;</span>

        error_page   <span class="token number">500</span> <span class="token number">502</span> <span class="token number">503</span> <span class="token number">504</span>  /50x.html<span class="token punctuation">;</span> <span class="token comment"># 如果服务器返回的是500 就指向到500.html</span>
        location <span class="token operator">=</span> /50x.html <span class="token punctuation">{</span>
            root   html<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_8-2-全局配置"><a href="#_8-2-全局配置" class="header-anchor">#</a> 8.2 全局配置</h3> <table><thead><tr><th>分类</th> <th>配置项</th> <th>作用</th></tr></thead> <tbody><tr><td>全局</td> <td>user</td> <td>设置 nginx 服务的系统使用用户</td></tr> <tr><td>全局</td> <td>worker_processes</td> <td>工作进程数,一般和 CPU 数量相同</td></tr> <tr><td>全局</td> <td>error_log</td> <td>nginx 的错误日志</td></tr> <tr><td>全局</td> <td>pid</td> <td>nginx 服务启动时的 pid</td></tr></tbody></table> <h3 id="_8-3-事件配置"><a href="#_8-3-事件配置" class="header-anchor">#</a> 8.3 事件配置</h3> <table><thead><tr><th>分类</th> <th>配置项</th> <th>作用</th></tr></thead> <tbody><tr><td>events</td> <td>worker_connections</td> <td>每个进程允许的最大连接数 10000</td></tr> <tr><td>events</td> <td>use</td> <td>指定使用哪种模型(select/poll/epoll),建议让 nginx 自动选择,linux 内核 2.6 以上一般能使用 epoll 可以提高性能</td></tr></tbody></table> <h3 id="_8-4-http-配置"><a href="#_8-4-http-配置" class="header-anchor">#</a> 8.4 http 配置</h3> <ul><li>/etc/nginx/nginx.conf</li> <li>一个 HTTP 下面可以配置多个 server</li></ul> <div class="language-bash extra-class"><pre class="language-bash"><code>user  nginx<span class="token punctuation">;</span>   <span class="token comment">#设置nginx服务的系统使用用户</span>
worker_processes  <span class="token number">1</span><span class="token punctuation">;</span>  <span class="token comment">#工作进程数,一般和CPU数量相同</span>

error_log  /var/log/nginx/error.log warn<span class="token punctuation">;</span>   <span class="token comment">#nginx的错误日志</span>
pid        /var/run/nginx.pid<span class="token punctuation">;</span>   <span class="token comment">#nginx服务启动时的pid</span>

events <span class="token punctuation">{</span>
    worker_connections  <span class="token number">1024</span><span class="token punctuation">;</span> <span class="token comment">#每个进程允许的最大连接数 10000</span>
<span class="token punctuation">}</span>

http <span class="token punctuation">{</span>
    include       /etc/nginx/mime.types<span class="token punctuation">;</span> <span class="token comment">#文件后缀和类型类型的对应关系</span>
    default_type  application/octet-stream<span class="token punctuation">;</span> <span class="token comment">#默认content-type</span>

    log_format  main  <span class="token string">'$remote_addr - $remote_user [$time_local] &quot;$request&quot; '</span>
                      <span class="token string">'$status $body_bytes_sent &quot;$http_referer&quot; '</span>
                      <span class="token string">'&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot;'</span><span class="token punctuation">;</span>  <span class="token comment"># 日志记录格式</span>

    access_log  /var/log/nginx/access.log  main<span class="token punctuation">;</span> <span class="token comment">#默认访问日志</span>

    sendfile        on<span class="token punctuation">;</span> <span class="token comment">#启用sendfile</span>
    <span class="token comment">#tcp_nopush     on; #懒发送</span>

    keepalive_timeout  <span class="token number">65</span><span class="token punctuation">;</span> <span class="token comment">#超时时间是65秒</span>

    <span class="token comment">#gzip  on; # 启用gzip压缩</span>

    include /etc/nginx/conf.d/*.conf<span class="token punctuation">;</span> <span class="token comment">#包含的子配置文件</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_8-5-server"><a href="#_8-5-server" class="header-anchor">#</a> 8.5 server</h3> <ul><li>/etc/nginx/conf.d/default.conf</li> <li>一个 server 下面可以配置多个 location</li></ul> <div class="language-bash extra-class"><pre class="language-bash"><code>server <span class="token punctuation">{</span>
    listen       <span class="token number">80</span><span class="token punctuation">;</span>  <span class="token comment">#监听的端口号</span>
    server_name  localhost<span class="token punctuation">;</span>  <span class="token comment">#用域名方式访问的地址</span>

    <span class="token comment">#charset koi8-r; //编码</span>
    <span class="token comment">#access_log  /var/log/nginx/host.access.log  main; #访问日志文件和名称</span>

    location / <span class="token punctuation">{</span>
        root   /usr/share/nginx/html<span class="token punctuation">;</span>  <span class="token comment">#静态文件根目录</span>
        index  index.html index.htm<span class="token punctuation">;</span>  <span class="token comment">#首页的索引文件</span>
    <span class="token punctuation">}</span>

    <span class="token comment">#error_page  404              /404.html;  #指定错误页面</span>

    <span class="token comment"># redirect server error pages to the static page /50x.html</span>
    <span class="token comment"># 把后台错误重定向到静态的50x.html页面</span>
    error_page   <span class="token number">500</span> <span class="token number">502</span> <span class="token number">503</span> <span class="token number">504</span>  /50x.html<span class="token punctuation">;</span>
    location <span class="token operator">=</span> /50x.html <span class="token punctuation">{</span>
        root   /usr/share/nginx/html<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_8-6-systemd"><a href="#_8-6-systemd" class="header-anchor">#</a> 8.6 Systemd</h3> <ul><li>系统启动和服务器守护进程管理器，负责在系统启动或运行时，激活系统资源，服务器进程和其他进程，根据管理，字母 d 是守护进程（daemon）的缩写</li></ul> <h4 id="_8-6-1-配置目录"><a href="#_8-6-1-配置目录" class="header-anchor">#</a> 8.6.1 配置目录</h4> <table><thead><tr><th>配置目录</th> <th>作用</th></tr></thead> <tbody><tr><td>/usr/lib/systemd/system</td> <td>每个服务最主要的启动脚本设置，类似于之前的/etc/initd.d</td></tr> <tr><td>/run/system/system</td> <td>系统执行过程中所产生的服务脚本，比上面的目录优先运行</td></tr> <tr><td>/etc/system/system</td> <td>管理员建立的执行脚本，类似于/etc/rc.d/rcN.d/Sxx 类的功能，比上面目录优先运行，在三者之中，此目录优先级最高</td></tr></tbody></table> <h4 id="_8-6-2-systemctl"><a href="#_8-6-2-systemctl" class="header-anchor">#</a> 8.6.2 systemctl</h4> <ul><li>监视和控制 systemd 的主要命令是 systemctl</li> <li>该命令可用于查看系统状态和管理系统及服务</li></ul> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># 命令：</span>
systemctl  <span class="token builtin class-name">command</span> name.service
<span class="token comment"># 启动：</span>
<span class="token function">service</span> name start –<span class="token operator">&gt;</span>systemctl start name.service
<span class="token comment"># 停止：</span>
<span class="token function">service</span> name stop –<span class="token operator">&gt;</span>systemctl stop name.service
<span class="token comment"># 重启：</span>
<span class="token function">service</span> name restart–<span class="token operator">&gt;</span>systemctl restart name.service
<span class="token comment"># 状态：</span>
<span class="token function">service</span> name status–<span class="token operator">&gt;</span>systemctl status name.service
</code></pre></div><h3 id="_8-7-启动和重新加载"><a href="#_8-7-启动和重新加载" class="header-anchor">#</a> 8.7 启动和重新加载</h3> <div class="language-bash extra-class"><pre class="language-bash"><code>systemctl restart nginx.service
systemctl reload nginx.service
nginx -s reload
</code></pre></div><h3 id="_8-8-日志类型"><a href="#_8-8-日志类型" class="header-anchor">#</a> 8.8 日志类型</h3> <ul><li><code>curl -v http://localhost</code></li></ul> <h4 id="_8-8-1-日志类型"><a href="#_8-8-1-日志类型" class="header-anchor">#</a> 8.8.1 日志类型</h4> <ul><li>/var/log/nginx/access.log 访问日志</li> <li>/var/log/nginx/error.log 错误日志</li></ul> <h4 id="_8-8-2-log-format"><a href="#_8-8-2-log-format" class="header-anchor">#</a> 8.8.2 log_format</h4> <table><thead><tr><th>类型</th> <th>用法</th></tr></thead> <tbody><tr><td>语法</td> <td>log_format name [escape=default[json] string]</td></tr> <tr><td>默认</td> <td>log_format combined &quot; &quot;</td></tr> <tr><td>Context</td> <td>http</td></tr></tbody></table> <h5 id="_8-8-2-1-内置变量"><a href="#_8-8-2-1-内置变量" class="header-anchor">#</a> 8.8.2.1 内置变量</h5> <p><a href="/FE_OPS/nginx/config/'http:/nginx.org/en/docs/http/ngx_http_log_module.html#log_format'">ngx_http_log_module log_format</a></p> <table><thead><tr><th>名称</th> <th>含义</th></tr></thead> <tbody><tr><td>$remote_addr</td> <td>客户端地址</td></tr> <tr><td>$remote_user</td> <td>客户端用户名称</td></tr> <tr><td>$time_local</td> <td>访问时间和时区</td></tr> <tr><td>$request</td> <td>请求行</td></tr> <tr><td>$status</td> <td>HTTP 请求状态</td></tr> <tr><td>$body_bytes_sent</td> <td>发送给客户端文件内容大小</td></tr></tbody></table> <h5 id="_8-8-2-2-http-请求变量"><a href="#_8-8-2-2-http-请求变量" class="header-anchor">#</a> 8.8.2.2 HTTP 请求变量</h5> <ul><li>注意要把-转成下划线,比如 User-Agent 对应于$http_user_agent</li></ul> <table><thead><tr><th>名称</th> <th>作用</th> <th>例子</th></tr></thead> <tbody><tr><td>arg_PARAMETER</td> <td>请求参数</td> <td>$arg_name</td></tr> <tr><td>http_HEADER</td> <td>请求头</td> <td>$http_referer $http_host $http_user_agent $http_x_forwarded_for(代理过程)</td></tr> <tr><td>sent_http_HEADER</td> <td>响应头</td> <td>sent_http_cookie</td></tr></tbody></table> <ul><li><p>IP1-&gt;IP2(代理)-&gt;IP3 会记录 IP 地址的代理过程</p> <ul><li>http_x_forwarded_for=Client IP,Proxy(1) IP,Proxy(2) IP</li></ul></li></ul> <p>例</p> <div class="language-bash extra-class"><pre class="language-bash"><code> <span class="token comment"># 定义一种日志格式</span>
 log_format  main  <span class="token string">'$remote_addr - $remote_user [$time_local] &quot;$request&quot; '</span>
                      <span class="token string">'$status $body_bytes_sent &quot;$http_referer&quot; '</span>
                      <span class="token string">'&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot;'</span><span class="token punctuation">;</span>

 log_format  zfpx  <span class="token string">'$arg_name $http_referer sent_http_date&quot;'</span><span class="token punctuation">;</span>
 <span class="token comment"># 指定写入的文件名和日志格式</span>
 access_log  /var/log/nginx/access.log  main<span class="token punctuation">;</span>
</code></pre></div><div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">tail</span> -f /var/log/nginx/access.log

<span class="token number">10.10</span>.18.150 - - <span class="token punctuation">[</span><span class="token number">30</span>/Dec/2021:21:54:45 -0500<span class="token punctuation">]</span> <span class="token string">&quot;GET / HTTP/1.1&quot;</span> <span class="token number">200</span> <span class="token number">4057</span> <span class="token string">&quot;-&quot;</span> <span class="token string">&quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/96.0.4664.110 Safari/537.36&quot;</span> <span class="token string">&quot;-&quot;</span>
</code></pre></div><h2 id="_9-nginx-工作流"><a href="#_9-nginx-工作流" class="header-anchor">#</a> 9.nginx 工作流</h2> <h3 id="_9-1-配置块"><a href="#_9-1-配置块" class="header-anchor">#</a> 9.1 配置块</h3> <ul><li>请求到来时先按域名找到 server 块</li> <li>再按请求路径找到 location 块</li> <li>Context 是指本指令出现在哪个块内</li></ul> <h3 id="_9-2-值指令继承规则"><a href="#_9-2-值指令继承规则" class="header-anchor">#</a> 9.2 值指令继承规则</h3> <ul><li>值指令可以合并，动作类指令不可以合并</li> <li>值指令是向上覆盖的，子配置不存在，可以使用父配置块的指令，如果子指令存在，会覆盖父配置块中的指令</li></ul> <div class="language-bash extra-class"><pre class="language-bash"><code>server <span class="token punctuation">{</span>
    listen <span class="token number">80</span><span class="token punctuation">;</span>
    root /home/nginx/html<span class="token punctuation">;</span>
    access_log logs/access.log main<span class="token punctuation">;</span>
    location /image<span class="token punctuation">{</span>
       access_log logs/access.log image<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    location /video<span class="token punctuation">{</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_9-3-server-匹配"><a href="#_9-3-server-匹配" class="header-anchor">#</a> 9.3 server 匹配</h3> <ul><li>精确匹配</li> <li>*在前</li> <li>*在后</li> <li>按文件中的顺序匹配正则式域名</li> <li>default server</li></ul> <h3 id="_9-4-http-请求处理"><a href="#_9-4-http-请求处理" class="header-anchor">#</a> 9.4 HTTP 请求处理</h3> <p><img src="/FE_OPS/assets/img/nginxflow.1480e750.png" alt="请求处理"></p> <table><thead><tr><th>阶段</th> <th>名称</th> <th>对应模块</th></tr></thead> <tbody><tr><td>读取请求后</td> <td>POST_READ</td> <td>realip</td></tr> <tr><td>重写</td> <td>SERVER_REWRITE</td> <td>rewrite</td></tr> <tr><td>匹配 location</td> <td>FIND_CONFIG</td> <td>rewrite</td></tr> <tr><td>重写</td> <td>REWRITE</td> <td>rewrite</td></tr> <tr><td>重写后</td> <td>POST_REWRITE</td> <td></td></tr> <tr><td>访问前限制</td> <td>PREACCESS</td> <td>limit_conn,limit_req</td></tr> <tr><td>是否有权限访问</td> <td>ACCESS</td> <td>auth_basic,access,auth_request</td></tr> <tr><td>判断权限后</td> <td>POST_ACCESS</td> <td></td></tr> <tr><td>响应前</td> <td>PRECONTENT</td> <td>try_files</td></tr> <tr><td>读取请求后</td> <td>CONTENT</td> <td>index,autoindex,concat</td></tr> <tr><td>打印日志</td> <td>LOG</td> <td>access_log</td></tr></tbody></table></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/FE_OPS/linux/network/" class="prev">
        九、网络
      </a></span> <span class="next"><a href="/FE_OPS/nginx/core/">
        nginx核心
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/FE_OPS/assets/js/app.00b3f334.js" defer></script><script src="/FE_OPS/assets/js/2.52b9351e.js" defer></script><script src="/FE_OPS/assets/js/7.ef58fabf.js" defer></script>
  </body>
</html>
