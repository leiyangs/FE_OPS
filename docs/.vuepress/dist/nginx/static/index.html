<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>静态资源 Web 服务 | 前端运维</title>
    <meta name="generator" content="VuePress 1.9.7">
    <link rel="icon" href="https://vuejs.org/images/logo.png">
    <meta name="description" content="linux、nginx、docker、持续集成、k8s">
    
    <link rel="preload" href="/FE_OPS/assets/css/0.styles.a6e8606b.css" as="style"><link rel="preload" href="/FE_OPS/assets/js/app.00b3f334.js" as="script"><link rel="preload" href="/FE_OPS/assets/js/2.52b9351e.js" as="script"><link rel="preload" href="/FE_OPS/assets/js/6.fa8f1b25.js" as="script"><link rel="prefetch" href="/FE_OPS/assets/js/10.cf2d6a62.js"><link rel="prefetch" href="/FE_OPS/assets/js/11.0ed17998.js"><link rel="prefetch" href="/FE_OPS/assets/js/12.4f4e2c3f.js"><link rel="prefetch" href="/FE_OPS/assets/js/13.6975663a.js"><link rel="prefetch" href="/FE_OPS/assets/js/14.5dc4cad6.js"><link rel="prefetch" href="/FE_OPS/assets/js/15.c369746b.js"><link rel="prefetch" href="/FE_OPS/assets/js/16.e2d1670e.js"><link rel="prefetch" href="/FE_OPS/assets/js/17.610e2c4c.js"><link rel="prefetch" href="/FE_OPS/assets/js/18.ab590110.js"><link rel="prefetch" href="/FE_OPS/assets/js/19.36b81dfb.js"><link rel="prefetch" href="/FE_OPS/assets/js/20.89f9143a.js"><link rel="prefetch" href="/FE_OPS/assets/js/21.6d57371e.js"><link rel="prefetch" href="/FE_OPS/assets/js/22.b34f833f.js"><link rel="prefetch" href="/FE_OPS/assets/js/23.db2c9f97.js"><link rel="prefetch" href="/FE_OPS/assets/js/24.f036be3b.js"><link rel="prefetch" href="/FE_OPS/assets/js/25.f703d930.js"><link rel="prefetch" href="/FE_OPS/assets/js/26.b5a6e88e.js"><link rel="prefetch" href="/FE_OPS/assets/js/3.2260921c.js"><link rel="prefetch" href="/FE_OPS/assets/js/4.0c064d44.js"><link rel="prefetch" href="/FE_OPS/assets/js/5.96777648.js"><link rel="prefetch" href="/FE_OPS/assets/js/7.ef58fabf.js"><link rel="prefetch" href="/FE_OPS/assets/js/8.fd3833a2.js"><link rel="prefetch" href="/FE_OPS/assets/js/9.278b10da.js">
    <link rel="stylesheet" href="/FE_OPS/assets/css/0.styles.a6e8606b.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/FE_OPS/" class="home-link router-link-active"><img src="https://vuejs.org/images/logo.png" alt="前端运维" class="logo"> <span class="site-name can-hide">前端运维</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/FE_OPS/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/FE_OPS/guide/" class="nav-link">
  Guide
</a></div><div class="nav-item"><a href="https://github.com/leiyangs" target="_blank" rel="noopener noreferrer" class="nav-link external">
  github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/FE_OPS/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/FE_OPS/guide/" class="nav-link">
  Guide
</a></div><div class="nav-item"><a href="https://github.com/leiyangs" target="_blank" rel="noopener noreferrer" class="nav-link external">
  github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Linux</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Nginx</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/FE_OPS/nginx/config/" class="sidebar-link">nginx安装/配置</a></li><li><a href="/FE_OPS/nginx/core/" class="sidebar-link">nginx核心</a></li><li><a href="/FE_OPS/nginx/static/" aria-current="page" class="active sidebar-link">静态资源服务</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/FE_OPS/nginx/static/#_1-静态和动态资源" class="sidebar-link">1. 静态和动态资源</a></li><li class="sidebar-sub-header"><a href="/FE_OPS/nginx/static/#_2-cdn" class="sidebar-link">2. CDN</a></li><li class="sidebar-sub-header"><a href="/FE_OPS/nginx/static/#_3-配置语法" class="sidebar-link">3. 配置语法</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/FE_OPS/nginx/static/#_3-1-sendfile" class="sidebar-link">3.1 sendfile</a></li><li class="sidebar-sub-header"><a href="/FE_OPS/nginx/static/#_3-2-tcp-nopush" class="sidebar-link">3.2 tcp_nopush</a></li><li class="sidebar-sub-header"><a href="/FE_OPS/nginx/static/#_3-3-tcp-nodelay" class="sidebar-link">3.3 tcp_nodelay</a></li><li class="sidebar-sub-header"><a href="/FE_OPS/nginx/static/#_3-4-gzip" class="sidebar-link">3.4 gzip</a></li><li class="sidebar-sub-header"><a href="/FE_OPS/nginx/static/#_3-5-gzip-comp-level" class="sidebar-link">3.5 gzipcomplevel</a></li><li class="sidebar-sub-header"><a href="/FE_OPS/nginx/static/#_3-6-gzip-http-version" class="sidebar-link">3.6 gziphttpversion</a></li><li class="sidebar-sub-header"><a href="/FE_OPS/nginx/static/#_3-7-http-gzip-static-module" class="sidebar-link">3.7 httpgzip-staticmodule</a></li><li class="sidebar-sub-header"><a href="/FE_OPS/nginx/static/#_3-8-例" class="sidebar-link">3.8 例</a></li></ul></li><li class="sidebar-sub-header"><a href="/FE_OPS/nginx/static/#_4-浏览器缓存" class="sidebar-link">4. 浏览器缓存</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/FE_OPS/nginx/static/#_4-1-expires" class="sidebar-link">4.1 expires</a></li></ul></li></ul></li><li><a href="/FE_OPS/nginx/crossDomain/" class="sidebar-link">跨域</a></li><li><a href="/FE_OPS/nginx/proxy/" class="sidebar-link">代理服务</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Docker</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>CICD</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>K8s</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="静态资源-web-服务"><a href="#静态资源-web-服务" class="header-anchor">#</a> 静态资源 Web 服务</h1> <h2 id="_1-静态和动态资源"><a href="#_1-静态和动态资源" class="header-anchor">#</a> 1. 静态和动态资源</h2> <ul><li>静态资源：一般客户端发送请求到 web 服务器，web 服务器从内存在取到相应的文件，返回给客户端，客户端解析并渲染显示出来。</li> <li>动态资源：一般客户端请求的动态资源，先将请求交于 web 容器，web 容器连接数据库，数据库处理数据之后，将内容交给 web 服务器，web 服务器返回给客户端解析渲染处理。</li></ul> <table><thead><tr><th>类型</th> <th>种类</th></tr></thead> <tbody><tr><td>浏览器渲染</td> <td>HTML、CSS、JS</td></tr> <tr><td>图片</td> <td>JPEG、GIF、PNG</td></tr> <tr><td>视频</td> <td>FLV、MPEG</td></tr> <tr><td>下载文件</td> <td>Word、Excel</td></tr></tbody></table> <h2 id="_2-cdn"><a href="#_2-cdn" class="header-anchor">#</a> 2. CDN</h2> <ul><li>CDN 的全称是 Content Delivery Network，即内容分发网络。</li> <li>CDN 系统能够实时地根据网络流量和各节点的连接、负载状况以及到用户的距离和响应时间等综合信息将用户的请求重新导向离用户最近的服务节点上。其目的是使用户可就近取得所需内容，解决 Internet 网络拥挤的状况，提高用户访问网站的响应速度。</li></ul> <p><img src="/FE_OPS/assets/img/cdn.366d088c.png" alt="CDN"></p> <h2 id="_3-配置语法"><a href="#_3-配置语法" class="header-anchor">#</a> 3. 配置语法</h2> <h3 id="_3-1-sendfile"><a href="#_3-1-sendfile" class="header-anchor">#</a> 3.1 sendfile</h3> <ul><li>不经过用户内核发送文件</li></ul> <table><thead><tr><th>类型</th> <th>种类</th></tr></thead> <tbody><tr><td>语法</td> <td>sendfile on / off</td></tr> <tr><td>默认</td> <td>sendfile off;</td></tr> <tr><td>上下文</td> <td>http,server,location,if in location</td></tr></tbody></table> <h3 id="_3-2-tcp-nopush"><a href="#_3-2-tcp-nopush" class="header-anchor">#</a> 3.2 tcp_nopush</h3> <ul><li>在 sendfile 开启的情况下，合并多个数据包，提高网络包的传输效率</li></ul> <table><thead><tr><th>类型</th> <th>种类</th></tr></thead> <tbody><tr><td>语法</td> <td>tcp_nopush on / off</td></tr> <tr><td>默认</td> <td>tcp_nopush off;</td></tr> <tr><td>上下文</td> <td>http,server,location</td></tr></tbody></table> <h3 id="_3-3-tcp-nodelay"><a href="#_3-3-tcp-nodelay" class="header-anchor">#</a> 3.3 tcp_nodelay</h3> <ul><li>在 keepalive 连接下，提高网络包的传输实时性</li></ul> <table><thead><tr><th>类型</th> <th>种类</th></tr></thead> <tbody><tr><td>语法</td> <td>tcp_nodelay on / off</td></tr> <tr><td>默认</td> <td>tcp_nodelay on;</td></tr> <tr><td>上下文</td> <td>http,server,location</td></tr></tbody></table> <h3 id="_3-4-gzip"><a href="#_3-4-gzip" class="header-anchor">#</a> 3.4 gzip</h3> <ul><li>压缩文件可以节约带宽和提高网络传输效率</li></ul> <table><thead><tr><th>类型</th> <th>种类</th></tr></thead> <tbody><tr><td>语法</td> <td>gzip on / off</td></tr> <tr><td>默认</td> <td>gzip off;</td></tr> <tr><td>上下文</td> <td>http,server,location</td></tr></tbody></table> <h3 id="_3-5-gzip-comp-level"><a href="#_3-5-gzip-comp-level" class="header-anchor">#</a> 3.5 gzip_comp_level</h3> <ul><li>压缩比率越高，文件被压缩的体积越小</li></ul> <table><thead><tr><th>类型</th> <th>种类</th></tr></thead> <tbody><tr><td>语法</td> <td>gzip_comp_level level</td></tr> <tr><td>默认</td> <td>gzip_comp_level 1;</td></tr> <tr><td>上下文</td> <td>http,server,location</td></tr></tbody></table> <h3 id="_3-6-gzip-http-version"><a href="#_3-6-gzip-http-version" class="header-anchor">#</a> 3.6 gzip_http_version</h3> <ul><li>压缩版本</li></ul> <table><thead><tr><th>类型</th> <th>种类</th></tr></thead> <tbody><tr><td>语法</td> <td>gzip_http_version 1.0/1.1</td></tr> <tr><td>默认</td> <td>gzip_http_version 1.1;</td></tr> <tr><td>上下文</td> <td>http,server,location</td></tr></tbody></table> <h3 id="_3-7-http-gzip-static-module"><a href="#_3-7-http-gzip-static-module" class="header-anchor">#</a> 3.7 http_gzip-static_module</h3> <ul><li>先找磁盘上找同名的.gz 这个文件是否存在,节约 CPU 的压缩时间和性能损耗</li> <li>http_gzip_static_module 预计 gzip 模块</li> <li>http_gunzip_module 应用支持 gunzip 的压缩方式</li></ul> <table><thead><tr><th>类型</th> <th>种类</th></tr></thead> <tbody><tr><td>语法</td> <td>gzip_static on/off</td></tr> <tr><td>默认</td> <td>gzip_static off;</td></tr> <tr><td>上下文</td> <td>http,server,location</td></tr></tbody></table> <h3 id="_3-8-例"><a href="#_3-8-例" class="header-anchor">#</a> 3.8 例</h3> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token builtin class-name">echo</span> color <span class="token operator">&gt;</span> color.html
<span class="token function">gzip</span> color.html
</code></pre></div><p>/etc/nginx/conf.d/default.conf</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">mkdir</span> -p /data/www/images
<span class="token function">mkdir</span> -p /data/www/html
<span class="token builtin class-name">echo</span> color <span class="token operator">&gt;</span> /data/www/html/color.html
<span class="token function">gzip</span> /data/www/html/color.html
<span class="token function">mkdir</span> -p /data/www/js
<span class="token function">mkdir</span> -p /data/www/css
<span class="token function">mkdir</span> -p /data/www/download
</code></pre></div><div class="language-bash extra-class"><pre class="language-bash"><code>location ~ .*<span class="token punctuation">\</span>.<span class="token punctuation">(</span>jpg<span class="token operator">|</span>png<span class="token operator">|</span>gif<span class="token punctuation">)</span>$ <span class="token punctuation">{</span>
  <span class="token function">gzip</span> off<span class="token punctuation">;</span><span class="token comment">#关闭压缩</span>
  root /data/www/images<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

location ~ .*<span class="token punctuation">\</span>.<span class="token punctuation">(</span>html<span class="token operator">|</span>js<span class="token operator">|</span>css<span class="token punctuation">)</span>$ <span class="token punctuation">{</span>
  gzip_static on<span class="token punctuation">;</span>
  <span class="token function">gzip</span> on<span class="token punctuation">;</span> <span class="token comment">#启用压缩</span>
  gzip_min_length 1k<span class="token punctuation">;</span>    <span class="token comment">#只压缩超过1K的文件</span>
  gzip_http_version <span class="token number">1.1</span><span class="token punctuation">;</span> <span class="token comment">#启用gzip压缩所需的HTTP最低版本</span>
  gzip_comp_level <span class="token number">9</span><span class="token punctuation">;</span>     <span class="token comment">#压缩级别，压缩比率越高文件被压缩的体积越小</span>
  gzip_types  text/css application/javascript<span class="token punctuation">;</span><span class="token comment">#进行压缩的文件类型</span>
  root /data/www/html<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

location ~ ^/download <span class="token punctuation">{</span>
  gzip_static on<span class="token punctuation">;</span> <span class="token comment">#启用压缩</span>
  tcp_nopush on<span class="token punctuation">;</span>  <span class="token comment"># 不要着急发，攒一波再发</span>
  root /data/www<span class="token punctuation">;</span> <span class="token comment"># 注意此处目录是`/data/www`而不是`/data/www/download`</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="_4-浏览器缓存"><a href="#_4-浏览器缓存" class="header-anchor">#</a> 4. 浏览器缓存</h2> <ul><li>校验本地缓存是否过期</li></ul> <p><img src="/FE_OPS/assets/img/cache.22c7ab11.png" alt="缓存"></p> <table><thead><tr><th>类型</th> <th>种类</th></tr></thead> <tbody><tr><td>检验是否过期</td> <td>Expires、Cache-Control(max-age)</td></tr> <tr><td>Etag</td> <td>Etag</td></tr> <tr><td>Last-Modified</td> <td>Last-Modified</td></tr></tbody></table> <h3 id="_4-1-expires"><a href="#_4-1-expires" class="header-anchor">#</a> 4.1 expires</h3> <ul><li>添加 Cache-Control、Expires 头</li></ul> <table><thead><tr><th>类型</th> <th>种类</th></tr></thead> <tbody><tr><td>语法</td> <td>expires time</td></tr> <tr><td>默认</td> <td>expires off;</td></tr> <tr><td>上下文</td> <td>http,server,location</td></tr></tbody></table> <div class="language-bash extra-class"><pre class="language-bash"><code>location ~ .*<span class="token punctuation">\</span>.<span class="token punctuation">(</span>jpg<span class="token operator">|</span>png<span class="token operator">|</span>gif<span class="token punctuation">)</span>$ <span class="token punctuation">{</span>
  expires 24h<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/FE_OPS/nginx/core/" class="prev">
        nginx核心
      </a></span> <span class="next"><a href="/FE_OPS/nginx/crossDomain/">
        跨域
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/FE_OPS/assets/js/app.00b3f334.js" defer></script><script src="/FE_OPS/assets/js/2.52b9351e.js" defer></script><script src="/FE_OPS/assets/js/6.fa8f1b25.js" defer></script>
  </body>
</html>
