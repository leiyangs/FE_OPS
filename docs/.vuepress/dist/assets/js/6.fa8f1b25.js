(window.webpackJsonp=window.webpackJsonp||[]).push([[6],{185:function(t,a,s){t.exports=s.p+"assets/img/cdn.366d088c.png"},186:function(t,a,s){t.exports=s.p+"assets/img/cache.22c7ab11.png"},211:function(t,a,s){"use strict";s.r(a);var _=s(6),v=Object(_.a)({},(function(){var t=this,a=t.$createElement,_=t._self._c||a;return _("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[_("h1",{attrs:{id:"静态资源-web-服务"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#静态资源-web-服务"}},[t._v("#")]),t._v(" 静态资源 Web 服务")]),t._v(" "),_("h2",{attrs:{id:"_1-静态和动态资源"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#_1-静态和动态资源"}},[t._v("#")]),t._v(" 1. 静态和动态资源")]),t._v(" "),_("ul",[_("li",[t._v("静态资源：一般客户端发送请求到 web 服务器，web 服务器从内存在取到相应的文件，返回给客户端，客户端解析并渲染显示出来。")]),t._v(" "),_("li",[t._v("动态资源：一般客户端请求的动态资源，先将请求交于 web 容器，web 容器连接数据库，数据库处理数据之后，将内容交给 web 服务器，web 服务器返回给客户端解析渲染处理。")])]),t._v(" "),_("table",[_("thead",[_("tr",[_("th",[t._v("类型")]),t._v(" "),_("th",[t._v("种类")])])]),t._v(" "),_("tbody",[_("tr",[_("td",[t._v("浏览器渲染")]),t._v(" "),_("td",[t._v("HTML、CSS、JS")])]),t._v(" "),_("tr",[_("td",[t._v("图片")]),t._v(" "),_("td",[t._v("JPEG、GIF、PNG")])]),t._v(" "),_("tr",[_("td",[t._v("视频")]),t._v(" "),_("td",[t._v("FLV、MPEG")])]),t._v(" "),_("tr",[_("td",[t._v("下载文件")]),t._v(" "),_("td",[t._v("Word、Excel")])])])]),t._v(" "),_("h2",{attrs:{id:"_2-cdn"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#_2-cdn"}},[t._v("#")]),t._v(" 2. CDN")]),t._v(" "),_("ul",[_("li",[t._v("CDN 的全称是 Content Delivery Network，即内容分发网络。")]),t._v(" "),_("li",[t._v("CDN 系统能够实时地根据网络流量和各节点的连接、负载状况以及到用户的距离和响应时间等综合信息将用户的请求重新导向离用户最近的服务节点上。其目的是使用户可就近取得所需内容，解决 Internet 网络拥挤的状况，提高用户访问网站的响应速度。")])]),t._v(" "),_("p",[_("img",{attrs:{src:s(185),alt:"CDN"}})]),t._v(" "),_("h2",{attrs:{id:"_3-配置语法"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#_3-配置语法"}},[t._v("#")]),t._v(" 3. 配置语法")]),t._v(" "),_("h3",{attrs:{id:"_3-1-sendfile"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-sendfile"}},[t._v("#")]),t._v(" 3.1 sendfile")]),t._v(" "),_("ul",[_("li",[t._v("不经过用户内核发送文件")])]),t._v(" "),_("table",[_("thead",[_("tr",[_("th",[t._v("类型")]),t._v(" "),_("th",[t._v("种类")])])]),t._v(" "),_("tbody",[_("tr",[_("td",[t._v("语法")]),t._v(" "),_("td",[t._v("sendfile on / off")])]),t._v(" "),_("tr",[_("td",[t._v("默认")]),t._v(" "),_("td",[t._v("sendfile off;")])]),t._v(" "),_("tr",[_("td",[t._v("上下文")]),t._v(" "),_("td",[t._v("http,server,location,if in location")])])])]),t._v(" "),_("h3",{attrs:{id:"_3-2-tcp-nopush"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-tcp-nopush"}},[t._v("#")]),t._v(" 3.2 tcp_nopush")]),t._v(" "),_("ul",[_("li",[t._v("在 sendfile 开启的情况下，合并多个数据包，提高网络包的传输效率")])]),t._v(" "),_("table",[_("thead",[_("tr",[_("th",[t._v("类型")]),t._v(" "),_("th",[t._v("种类")])])]),t._v(" "),_("tbody",[_("tr",[_("td",[t._v("语法")]),t._v(" "),_("td",[t._v("tcp_nopush on / off")])]),t._v(" "),_("tr",[_("td",[t._v("默认")]),t._v(" "),_("td",[t._v("tcp_nopush off;")])]),t._v(" "),_("tr",[_("td",[t._v("上下文")]),t._v(" "),_("td",[t._v("http,server,location")])])])]),t._v(" "),_("h3",{attrs:{id:"_3-3-tcp-nodelay"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#_3-3-tcp-nodelay"}},[t._v("#")]),t._v(" 3.3 tcp_nodelay")]),t._v(" "),_("ul",[_("li",[t._v("在 keepalive 连接下，提高网络包的传输实时性")])]),t._v(" "),_("table",[_("thead",[_("tr",[_("th",[t._v("类型")]),t._v(" "),_("th",[t._v("种类")])])]),t._v(" "),_("tbody",[_("tr",[_("td",[t._v("语法")]),t._v(" "),_("td",[t._v("tcp_nodelay on / off")])]),t._v(" "),_("tr",[_("td",[t._v("默认")]),t._v(" "),_("td",[t._v("tcp_nodelay on;")])]),t._v(" "),_("tr",[_("td",[t._v("上下文")]),t._v(" "),_("td",[t._v("http,server,location")])])])]),t._v(" "),_("h3",{attrs:{id:"_3-4-gzip"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#_3-4-gzip"}},[t._v("#")]),t._v(" 3.4 gzip")]),t._v(" "),_("ul",[_("li",[t._v("压缩文件可以节约带宽和提高网络传输效率")])]),t._v(" "),_("table",[_("thead",[_("tr",[_("th",[t._v("类型")]),t._v(" "),_("th",[t._v("种类")])])]),t._v(" "),_("tbody",[_("tr",[_("td",[t._v("语法")]),t._v(" "),_("td",[t._v("gzip on / off")])]),t._v(" "),_("tr",[_("td",[t._v("默认")]),t._v(" "),_("td",[t._v("gzip off;")])]),t._v(" "),_("tr",[_("td",[t._v("上下文")]),t._v(" "),_("td",[t._v("http,server,location")])])])]),t._v(" "),_("h3",{attrs:{id:"_3-5-gzip-comp-level"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#_3-5-gzip-comp-level"}},[t._v("#")]),t._v(" 3.5 gzip_comp_level")]),t._v(" "),_("ul",[_("li",[t._v("压缩比率越高，文件被压缩的体积越小")])]),t._v(" "),_("table",[_("thead",[_("tr",[_("th",[t._v("类型")]),t._v(" "),_("th",[t._v("种类")])])]),t._v(" "),_("tbody",[_("tr",[_("td",[t._v("语法")]),t._v(" "),_("td",[t._v("gzip_comp_level level")])]),t._v(" "),_("tr",[_("td",[t._v("默认")]),t._v(" "),_("td",[t._v("gzip_comp_level 1;")])]),t._v(" "),_("tr",[_("td",[t._v("上下文")]),t._v(" "),_("td",[t._v("http,server,location")])])])]),t._v(" "),_("h3",{attrs:{id:"_3-6-gzip-http-version"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#_3-6-gzip-http-version"}},[t._v("#")]),t._v(" 3.6 gzip_http_version")]),t._v(" "),_("ul",[_("li",[t._v("压缩版本")])]),t._v(" "),_("table",[_("thead",[_("tr",[_("th",[t._v("类型")]),t._v(" "),_("th",[t._v("种类")])])]),t._v(" "),_("tbody",[_("tr",[_("td",[t._v("语法")]),t._v(" "),_("td",[t._v("gzip_http_version 1.0/1.1")])]),t._v(" "),_("tr",[_("td",[t._v("默认")]),t._v(" "),_("td",[t._v("gzip_http_version 1.1;")])]),t._v(" "),_("tr",[_("td",[t._v("上下文")]),t._v(" "),_("td",[t._v("http,server,location")])])])]),t._v(" "),_("h3",{attrs:{id:"_3-7-http-gzip-static-module"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#_3-7-http-gzip-static-module"}},[t._v("#")]),t._v(" 3.7 http_gzip-static_module")]),t._v(" "),_("ul",[_("li",[t._v("先找磁盘上找同名的.gz 这个文件是否存在,节约 CPU 的压缩时间和性能损耗")]),t._v(" "),_("li",[t._v("http_gzip_static_module 预计 gzip 模块")]),t._v(" "),_("li",[t._v("http_gunzip_module 应用支持 gunzip 的压缩方式")])]),t._v(" "),_("table",[_("thead",[_("tr",[_("th",[t._v("类型")]),t._v(" "),_("th",[t._v("种类")])])]),t._v(" "),_("tbody",[_("tr",[_("td",[t._v("语法")]),t._v(" "),_("td",[t._v("gzip_static on/off")])]),t._v(" "),_("tr",[_("td",[t._v("默认")]),t._v(" "),_("td",[t._v("gzip_static off;")])]),t._v(" "),_("tr",[_("td",[t._v("上下文")]),t._v(" "),_("td",[t._v("http,server,location")])])])]),t._v(" "),_("h3",{attrs:{id:"_3-8-例"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#_3-8-例"}},[t._v("#")]),t._v(" 3.8 例")]),t._v(" "),_("div",{staticClass:"language-bash extra-class"},[_("pre",{pre:!0,attrs:{class:"language-bash"}},[_("code",[_("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("echo")]),t._v(" color "),_("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" color.html\n"),_("span",{pre:!0,attrs:{class:"token function"}},[t._v("gzip")]),t._v(" color.html\n")])])]),_("p",[t._v("/etc/nginx/conf.d/default.conf")]),t._v(" "),_("div",{staticClass:"language-bash extra-class"},[_("pre",{pre:!0,attrs:{class:"language-bash"}},[_("code",[_("span",{pre:!0,attrs:{class:"token function"}},[t._v("mkdir")]),t._v(" -p /data/www/images\n"),_("span",{pre:!0,attrs:{class:"token function"}},[t._v("mkdir")]),t._v(" -p /data/www/html\n"),_("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("echo")]),t._v(" color "),_("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" /data/www/html/color.html\n"),_("span",{pre:!0,attrs:{class:"token function"}},[t._v("gzip")]),t._v(" /data/www/html/color.html\n"),_("span",{pre:!0,attrs:{class:"token function"}},[t._v("mkdir")]),t._v(" -p /data/www/js\n"),_("span",{pre:!0,attrs:{class:"token function"}},[t._v("mkdir")]),t._v(" -p /data/www/css\n"),_("span",{pre:!0,attrs:{class:"token function"}},[t._v("mkdir")]),t._v(" -p /data/www/download\n")])])]),_("div",{staticClass:"language-bash extra-class"},[_("pre",{pre:!0,attrs:{class:"language-bash"}},[_("code",[t._v("location ~ .*"),_("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("."),_("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("jpg"),_("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("png"),_("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("gif"),_("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("$ "),_("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),_("span",{pre:!0,attrs:{class:"token function"}},[t._v("gzip")]),t._v(" off"),_("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),_("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#关闭压缩")]),t._v("\n  root /data/www/images"),_("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),_("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\nlocation ~ .*"),_("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("."),_("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("html"),_("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("js"),_("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("css"),_("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("$ "),_("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  gzip_static on"),_("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),_("span",{pre:!0,attrs:{class:"token function"}},[t._v("gzip")]),t._v(" on"),_("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),_("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#启用压缩")]),t._v("\n  gzip_min_length 1k"),_("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("    "),_("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#只压缩超过1K的文件")]),t._v("\n  gzip_http_version "),_("span",{pre:!0,attrs:{class:"token number"}},[t._v("1.1")]),_("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),_("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#启用gzip压缩所需的HTTP最低版本")]),t._v("\n  gzip_comp_level "),_("span",{pre:!0,attrs:{class:"token number"}},[t._v("9")]),_("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("     "),_("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#压缩级别，压缩比率越高文件被压缩的体积越小")]),t._v("\n  gzip_types  text/css application/javascript"),_("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),_("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#进行压缩的文件类型")]),t._v("\n  root /data/www/html"),_("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),_("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\nlocation ~ ^/download "),_("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  gzip_static on"),_("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),_("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#启用压缩")]),t._v("\n  tcp_nopush on"),_("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("  "),_("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 不要着急发，攒一波再发")]),t._v("\n  root /data/www"),_("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),_("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 注意此处目录是`/data/www`而不是`/data/www/download`")]),t._v("\n"),_("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),_("h2",{attrs:{id:"_4-浏览器缓存"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#_4-浏览器缓存"}},[t._v("#")]),t._v(" 4. 浏览器缓存")]),t._v(" "),_("ul",[_("li",[t._v("校验本地缓存是否过期")])]),t._v(" "),_("p",[_("img",{attrs:{src:s(186),alt:"缓存"}})]),t._v(" "),_("table",[_("thead",[_("tr",[_("th",[t._v("类型")]),t._v(" "),_("th",[t._v("种类")])])]),t._v(" "),_("tbody",[_("tr",[_("td",[t._v("检验是否过期")]),t._v(" "),_("td",[t._v("Expires、Cache-Control(max-age)")])]),t._v(" "),_("tr",[_("td",[t._v("Etag")]),t._v(" "),_("td",[t._v("Etag")])]),t._v(" "),_("tr",[_("td",[t._v("Last-Modified")]),t._v(" "),_("td",[t._v("Last-Modified")])])])]),t._v(" "),_("h3",{attrs:{id:"_4-1-expires"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#_4-1-expires"}},[t._v("#")]),t._v(" 4.1 expires")]),t._v(" "),_("ul",[_("li",[t._v("添加 Cache-Control、Expires 头")])]),t._v(" "),_("table",[_("thead",[_("tr",[_("th",[t._v("类型")]),t._v(" "),_("th",[t._v("种类")])])]),t._v(" "),_("tbody",[_("tr",[_("td",[t._v("语法")]),t._v(" "),_("td",[t._v("expires time")])]),t._v(" "),_("tr",[_("td",[t._v("默认")]),t._v(" "),_("td",[t._v("expires off;")])]),t._v(" "),_("tr",[_("td",[t._v("上下文")]),t._v(" "),_("td",[t._v("http,server,location")])])])]),t._v(" "),_("div",{staticClass:"language-bash extra-class"},[_("pre",{pre:!0,attrs:{class:"language-bash"}},[_("code",[t._v("location ~ .*"),_("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("."),_("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("jpg"),_("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("png"),_("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("gif"),_("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("$ "),_("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  expires 24h"),_("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),_("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])])}),[],!1,null,null,null);a.default=v.exports}}]);