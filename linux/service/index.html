<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>服务 | 前端运维</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" href="/FE_OPS/images/logo.png">
    <meta name="description" content="linux、nginx、docker、持续集成、k8s">
    
    <link rel="preload" href="/FE_OPS/assets/css/0.styles.e449f2e7.css" as="style"><link rel="preload" href="/FE_OPS/assets/js/app.f808ba23.js" as="script"><link rel="preload" href="/FE_OPS/assets/js/2.6d182741.js" as="script"><link rel="preload" href="/FE_OPS/assets/js/21.5debafb8.js" as="script"><link rel="prefetch" href="/FE_OPS/assets/js/10.c0c1c398.js"><link rel="prefetch" href="/FE_OPS/assets/js/11.ed2eca99.js"><link rel="prefetch" href="/FE_OPS/assets/js/12.05e4c753.js"><link rel="prefetch" href="/FE_OPS/assets/js/13.1282068a.js"><link rel="prefetch" href="/FE_OPS/assets/js/14.2b118383.js"><link rel="prefetch" href="/FE_OPS/assets/js/15.82c37d9b.js"><link rel="prefetch" href="/FE_OPS/assets/js/16.14bca54b.js"><link rel="prefetch" href="/FE_OPS/assets/js/17.25d72bb0.js"><link rel="prefetch" href="/FE_OPS/assets/js/18.615d7827.js"><link rel="prefetch" href="/FE_OPS/assets/js/19.238a8f3d.js"><link rel="prefetch" href="/FE_OPS/assets/js/20.790dcd64.js"><link rel="prefetch" href="/FE_OPS/assets/js/22.223dd6d1.js"><link rel="prefetch" href="/FE_OPS/assets/js/23.ee5274d0.js"><link rel="prefetch" href="/FE_OPS/assets/js/24.fd0d142b.js"><link rel="prefetch" href="/FE_OPS/assets/js/25.1e5d77be.js"><link rel="prefetch" href="/FE_OPS/assets/js/26.63bbcedd.js"><link rel="prefetch" href="/FE_OPS/assets/js/3.a009c19c.js"><link rel="prefetch" href="/FE_OPS/assets/js/4.c8eed46e.js"><link rel="prefetch" href="/FE_OPS/assets/js/5.2bf1e0f5.js"><link rel="prefetch" href="/FE_OPS/assets/js/6.bbba5b42.js"><link rel="prefetch" href="/FE_OPS/assets/js/7.510f56de.js"><link rel="prefetch" href="/FE_OPS/assets/js/8.89a443f1.js"><link rel="prefetch" href="/FE_OPS/assets/js/9.b2518ed4.js">
    <link rel="stylesheet" href="/FE_OPS/assets/css/0.styles.e449f2e7.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/FE_OPS/" class="home-link router-link-active"><img src="/FE_OPS/images/logo.png" alt="前端运维" class="logo"> <span class="site-name can-hide">前端运维</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/FE_OPS/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/FE_OPS/guide/" class="nav-link">
  Guide
</a></div><div class="nav-item"><a href="https://github.com/leiyangs" target="_blank" rel="noopener noreferrer" class="nav-link external">
  github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/FE_OPS/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/FE_OPS/guide/" class="nav-link">
  Guide
</a></div><div class="nav-item"><a href="https://github.com/leiyangs" target="_blank" rel="noopener noreferrer" class="nav-link external">
  github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Linux</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/FE_OPS/linux/concept/" class="sidebar-link">一、linux概念</a></li><li><a href="/FE_OPS/linux/command/" class="sidebar-link">二、linux命令</a></li><li><a href="/FE_OPS/linux/vi/" class="sidebar-link">三、vi编辑器</a></li><li><a href="/FE_OPS/linux/user/" class="sidebar-link">四、用户&amp;用户组</a></li><li><a href="/FE_OPS/linux/authorization/" class="sidebar-link">五、文件权限</a></li><li><a href="/FE_OPS/linux/shell/" class="sidebar-link">六、shell</a></li><li><a href="/FE_OPS/linux/install/" class="sidebar-link">七、软件包管理</a></li><li><a href="/FE_OPS/linux/process/" class="sidebar-link">八、进程管理</a></li><li><a href="/FE_OPS/linux/service/" aria-current="page" class="active sidebar-link">九、服务</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/FE_OPS/linux/service/#_1-服务和分类" class="sidebar-link">1. 服务和分类</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/FE_OPS/linux/service/#_1-1-运行级别" class="sidebar-link">1.1 运行级别</a></li><li class="sidebar-sub-header"><a href="/FE_OPS/linux/service/#_1-1-1-运行级别分类" class="sidebar-link" style="padding-left:3rem;">1.1.1 运行级别分类</a></li><li class="sidebar-sub-header"><a href="/FE_OPS/linux/service/#_1-1-2-查看上一个级别和当前级别" class="sidebar-link" style="padding-left:3rem;">1.1.2 查看上一个级别和当前级别</a></li><li class="sidebar-sub-header"><a href="/FE_OPS/linux/service/#_1-1-3-切换运行级别" class="sidebar-link" style="padding-left:3rem;">1.1.3 切换运行级别</a></li><li class="sidebar-sub-header"><a href="/FE_OPS/linux/service/#_1-1-4-设置默认运行级别" class="sidebar-link" style="padding-left:3rem;">1.1.4 设置默认运行级别</a></li><li class="sidebar-sub-header"><a href="/FE_OPS/linux/service/#_1-2-服务的分类" class="sidebar-link">1.2 服务的分类</a></li><li class="sidebar-sub-header"><a href="/FE_OPS/linux/service/#_1-2-1-服务管理的方式" class="sidebar-link" style="padding-left:3rem;">1.2.1 服务管理的方式</a></li><li class="sidebar-sub-header"><a href="/FE_OPS/linux/service/#_1-2-2-查看-rpm-包安装的服务" class="sidebar-link" style="padding-left:3rem;">1.2.2 查看 RPM 包安装的服务</a></li><li class="sidebar-sub-header"><a href="/FE_OPS/linux/service/#_1-2-3-查看源码包安装的服务" class="sidebar-link" style="padding-left:3rem;">1.2.3 查看源码包安装的服务</a></li><li class="sidebar-sub-header"><a href="/FE_OPS/linux/service/#_1-2-4-启动和自启动" class="sidebar-link" style="padding-left:3rem;">1.2.4 启动和自启动</a></li><li class="sidebar-sub-header"><a href="/FE_OPS/linux/service/#_1-3-服务与端口" class="sidebar-link">1.3 服务与端口</a></li><li class="sidebar-sub-header"><a href="/FE_OPS/linux/service/#_1-4-查询系统中监听的端口" class="sidebar-link">1.4 查询系统中监听的端口</a></li></ul></li><li class="sidebar-sub-header"><a href="/FE_OPS/linux/service/#_2-prm-包服务管理" class="sidebar-link">2. PRM 包服务管理</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/FE_OPS/linux/service/#_2-1-rpm-命令" class="sidebar-link">2.1 rpm 命令</a></li><li class="sidebar-sub-header"><a href="/FE_OPS/linux/service/#_2-2-repo" class="sidebar-link">2.2 repo</a></li><li class="sidebar-sub-header"><a href="/FE_OPS/linux/service/#_2-3-rpm-包的默认安装位置" class="sidebar-link">2.3 RPM 包的默认安装位置</a></li><li class="sidebar-sub-header"><a href="/FE_OPS/linux/service/#_2-4-启动命令" class="sidebar-link">2.4 启动命令</a></li></ul></li><li class="sidebar-sub-header"><a href="/FE_OPS/linux/service/#_3-源码包服务管理" class="sidebar-link">3. 源码包服务管理</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/FE_OPS/linux/service/#_3-1-安装-nginx" class="sidebar-link">3.1 安装 nginx</a></li><li class="sidebar-sub-header"><a href="/FE_OPS/linux/service/#_3-1-1-安装依赖" class="sidebar-link" style="padding-left:3rem;">3.1.1 安装依赖</a></li><li class="sidebar-sub-header"><a href="/FE_OPS/linux/service/#_3-1-2-下载源文件" class="sidebar-link" style="padding-left:3rem;">3.1.2 下载源文件</a></li><li class="sidebar-sub-header"><a href="/FE_OPS/linux/service/#_3-1-2-1-pcre" class="sidebar-link" style="padding-left:4rem;">3.1.2.1 PCRE</a></li><li class="sidebar-sub-header"><a href="/FE_OPS/linux/service/#_3-1-2-2-zlib" class="sidebar-link" style="padding-left:4rem;">3.1.2.2 zlib</a></li><li class="sidebar-sub-header"><a href="/FE_OPS/linux/service/#_3-1-2-3-openssl" class="sidebar-link" style="padding-left:4rem;">3.1.2.3 openssl</a></li><li class="sidebar-sub-header"><a href="/FE_OPS/linux/service/#_3-1-2-4-nginx" class="sidebar-link" style="padding-left:4rem;">3.1.2.4 nginx</a></li><li class="sidebar-sub-header"><a href="/FE_OPS/linux/service/#_3-1-3-解压文件" class="sidebar-link" style="padding-left:3rem;">3.1.3 解压文件</a></li><li class="sidebar-sub-header"><a href="/FE_OPS/linux/service/#_3-1-4-配置和安装" class="sidebar-link" style="padding-left:3rem;">3.1.4 配置和安装</a></li><li class="sidebar-sub-header"><a href="/FE_OPS/linux/service/#_3-1-5-管理命令" class="sidebar-link" style="padding-left:3rem;">3.1.5 管理命令</a></li><li class="sidebar-sub-header"><a href="/FE_OPS/linux/service/#_3-1-6-以服务启动-service" class="sidebar-link" style="padding-left:3rem;">3.1.6 以服务启动 service</a></li><li class="sidebar-sub-header"><a href="/FE_OPS/linux/service/#_3-1-7-chkconfig" class="sidebar-link" style="padding-left:3rem;">3.1.7 chkconfig</a></li></ul></li></ul></li><li><a href="/FE_OPS/linux/network/" class="sidebar-link">九、网络</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Nginx</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Docker</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>CICD</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>K8s</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="服务"><a href="#服务" class="header-anchor">#</a> 服务</h1> <h2 id="_1-服务和分类"><a href="#_1-服务和分类" class="header-anchor">#</a> 1. 服务和分类</h2> <h3 id="_1-1-运行级别"><a href="#_1-1-运行级别" class="header-anchor">#</a> 1.1 运行级别</h3> <h4 id="_1-1-1-运行级别分类"><a href="#_1-1-1-运行级别分类" class="header-anchor">#</a> 1.1.1 运行级别分类</h4> <table><thead><tr><th>运行级别</th> <th>含义</th></tr></thead> <tbody><tr><td>0 关机</td> <td></td></tr> <tr><td>1</td> <td>单用户,类似于 Window 的安全模式，主要用于系统修复</td></tr> <tr><td>2</td> <td>不完全多用户，类似于字符界面，但不包含 NFS(Linux 和 Window 进行文件共享)服务</td></tr> <tr><td>3</td> <td>完整的命令行模式，就是标准的字符界面</td></tr> <tr><td>4</td> <td>系统保留未使用</td></tr> <tr><td>5</td> <td>图形界面</td></tr> <tr><td>5</td> <td>图形界面</td></tr> <tr><td>6</td> <td>重启</td></tr></tbody></table> <h4 id="_1-1-2-查看上一个级别和当前级别"><a href="#_1-1-2-查看上一个级别和当前级别" class="header-anchor">#</a> 1.1.2 查看上一个级别和当前级别</h4> <div class="language-bash extra-class"><pre class="language-bash"><code>runlevel
<span class="token number">3</span> <span class="token number">5</span>
</code></pre></div><h4 id="_1-1-3-切换运行级别"><a href="#_1-1-3-切换运行级别" class="header-anchor">#</a> 1.1.3 切换运行级别</h4> <div class="language-bash extra-class"><pre class="language-bash"><code>init <span class="token number">5</span>
</code></pre></div><h4 id="_1-1-4-设置默认运行级别"><a href="#_1-1-4-设置默认运行级别" class="header-anchor">#</a> 1.1.4 设置默认运行级别</h4> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">vi</span> /etc/inittab
id:3:initdefault:
</code></pre></div><h3 id="_1-2-服务的分类"><a href="#_1-2-服务的分类" class="header-anchor">#</a> 1.2 服务的分类</h3> <ul><li>系统开启的服务越少，服务器就会更加稳定和安全</li> <li>服务安装方式不同，启动的方式也不同</li></ul> <h4 id="_1-2-1-服务管理的方式"><a href="#_1-2-1-服务管理的方式" class="header-anchor">#</a> 1.2.1 服务管理的方式</h4> <ul><li>RPM 包安装的服务,由软件包作者指定安装位置,独立的服务，绝大多数服务都是独立运行在内存中的，可以直接响应客户端的请求</li> <li>源码包安装的服务，由我们用户决定安装位置</li></ul> <h4 id="_1-2-2-查看-rpm-包安装的服务"><a href="#_1-2-2-查看-rpm-包安装的服务" class="header-anchor">#</a> 1.2.2 查看 RPM 包安装的服务</h4> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">chkconfig</span> --list
</code></pre></div><h4 id="_1-2-3-查看源码包安装的服务"><a href="#_1-2-3-查看源码包安装的服务" class="header-anchor">#</a> 1.2.3 查看源码包安装的服务</h4> <ul><li>查看自定义的安装位置，默认为/usr/local 下</li> <li>usr= Unix System Resource 系统资源</li></ul> <h4 id="_1-2-4-启动和自启动"><a href="#_1-2-4-启动和自启动" class="header-anchor">#</a> 1.2.4 启动和自启动</h4> <ul><li>启动服务就是指让此服务在当前系统中运行，并向客户端提供服务</li> <li>服务自启动就是指通过设置，让此服务在开机或者重启后随着系统启动而自动启动</li></ul> <h3 id="_1-3-服务与端口"><a href="#_1-3-服务与端口" class="header-anchor">#</a> 1.3 服务与端口</h3> <ul><li>查看系统中的运行中的进程</li></ul> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">ps</span> -aux
</code></pre></div><ul><li>查看常见服务端口</li></ul> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">cat</span> /etc/services
</code></pre></div><h3 id="_1-4-查询系统中监听的端口"><a href="#_1-4-查询系统中监听的端口" class="header-anchor">#</a> 1.4 查询系统中监听的端口</h3> <ul><li>netstat -tulnp</li></ul> <table><thead><tr><th>参数</th> <th>含义</th></tr></thead> <tbody><tr><td>-t</td> <td>列出 tcp 数据</td></tr> <tr><td>-u</td> <td>列出 udp 数据</td></tr> <tr><td>-l</td> <td>列出正在监听的网络服务</td></tr> <tr><td>-n</td> <td>用端口号来显示服务，而非服务名</td></tr> <tr><td>-p</td> <td>列出该服务的进程 ID</td></tr></tbody></table> <h2 id="_2-prm-包服务管理"><a href="#_2-prm-包服务管理" class="header-anchor">#</a> 2. PRM 包服务管理</h2> <ul><li>RMP 是 LINUX 下的一种软件的可执行程序，你只要安装它就可以了。这种软件安装包通常是一个 RPM 包（Redhat Linux Packet Manager，就是 Redhat 的包管理器），后缀是.rpm</li> <li>RPM 是 Red Hat 公司随 Redhat Linux 推出了一个软件包管理器，通过它能够更加轻松容易地实现软件的安装</li></ul> <h3 id="_2-1-rpm-命令"><a href="#_2-1-rpm-命令" class="header-anchor">#</a> 2.1 rpm 命令</h3> <table><thead><tr><th>命令</th> <th>含义</th></tr></thead> <tbody><tr><td>安装软件</td> <td>执行 rpm -ivh rpm 包名 其中 i 表示安装 install，v 表示显示安装过程 verbose，h 表示显示进度</td></tr> <tr><td>升级软件</td> <td>执行 rpm -Uvh rpm 包名 U 表示升级 update</td></tr> <tr><td>反安装</td> <td>执行 rpm -e rpm 包名</td></tr> <tr><td>查询软件包的详细信息</td> <td>执行 rpm -qpi rpm 包名</td></tr> <tr><td>查询某个文件是属于那个 rpm 包的</td> <td>执行 rpm -qf rpm 包名</td></tr> <tr><td>查该软件包会向系统里面写入哪些文件</td> <td>执行 rpm -qpl rpm 包名</td></tr></tbody></table> <h3 id="_2-2-repo"><a href="#_2-2-repo" class="header-anchor">#</a> 2.2 repo</h3> <ul><li>repo 文件是 yum 源（软件仓库）的配置文件，通常一个 repo 文件定义了一个或者多个软件仓库的细节内容，例如我们将从哪里下载需要安装或者升级的软件包，repo 文件中的设置内容将被 yum 读取和应用</li> <li>服务器端：在服务器上面存放了所有的 RPM 软件包，然后以相关的功能去分析每个 RPM 文件的依赖性关系，将这些数据记录成文件存放在服务器的某特定目录内。</li> <li>客户端：如果需要安装某个软件时，先下载服务器上面记录的依赖性关系文件(可通过 WWW 或 FTP 方式)，通过对服务器端下载的纪录数据进行分析，然后取得所有相关的软件，一次全部下载下来进行安装。</li></ul> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">cat</span> /etc/yum.conf
/etc/yum.repos.d
/etc/yum.repos.d/nginx.repo
</code></pre></div><h3 id="_2-3-rpm-包的默认安装位置"><a href="#_2-3-rpm-包的默认安装位置" class="header-anchor">#</a> 2.3 RPM 包的默认安装位置</h3> <table><thead><tr><th>文件</th> <th>含义</th></tr></thead> <tbody><tr><td>/etc</td> <td>配置文件位置</td></tr> <tr><td>/etc/init.d</td> <td>启动脚本位置</td></tr> <tr><td>/etc/sysconfig</td> <td>初始化环境配置文件位置</td></tr> <tr><td>/var/lib</td> <td>服务产生的数据放在这里</td></tr> <tr><td>/var/log</td> <td>日志</td></tr></tbody></table> <h3 id="_2-4-启动命令"><a href="#_2-4-启动命令" class="header-anchor">#</a> 2.4 启动命令</h3> <ul><li>systemd 是 Linux 系统最新的初始化系统(init),作用是提高系统的启动速度，尽可能启动较少的进程，尽可能更多进程并发启动</li> <li>systemd 对应的进程管理命令是 <code>systemctl</code></li></ul> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># 下载nginx安装源</span>
<span class="token function">rpm</span> -ivh http://nginx.org/packages/centos/6/noarch/RPMS/nginx-release-centos-6-0.el6.ngx.noarch.rpm
yum info nginx
<span class="token comment"># 安装nginx</span>
yum <span class="token function">install</span> -y nginx
<span class="token comment"># 启动nginx</span>
systemctl start nginx.service
<span class="token function">netstat</span> -ltun <span class="token operator">|</span> <span class="token function">grep</span> <span class="token number">80</span>
<span class="token function">curl</span> http://localhost
</code></pre></div><h2 id="_3-源码包服务管理"><a href="#_3-源码包服务管理" class="header-anchor">#</a> 3. 源码包服务管理</h2> <p><strong>通过源码包安装软件，通常使用 yum 包管理安装</strong></p> <ul><li>使用绝对路径，调用启动脚本来启动。</li> <li>不同的源码包的启动脚本不一样</li> <li>要通过阅读源码包安装说明的方式来查看启动的方法</li></ul> <h3 id="_3-1-安装-nginx"><a href="#_3-1-安装-nginx" class="header-anchor">#</a> 3.1 安装 nginx</h3> <h4 id="_3-1-1-安装依赖"><a href="#_3-1-1-安装依赖" class="header-anchor">#</a> 3.1.1 安装依赖</h4> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">mkdir</span> /root/nginxinstall
<span class="token builtin class-name">cd</span> /root/nginxinstall
<span class="token comment"># 一般去到官网下载，</span>
<span class="token comment"># gcc C语言编译器 perl 正则包</span>
yum <span class="token function">install</span> gcc gcc-c++ perl -y
</code></pre></div><h4 id="_3-1-2-下载源文件"><a href="#_3-1-2-下载源文件" class="header-anchor">#</a> 3.1.2 下载源文件</h4> <h5 id="_3-1-2-1-pcre"><a href="#_3-1-2-1-pcre" class="header-anchor">#</a> 3.1.2.1 PCRE</h5> <ul><li><a href="http://www.pcre.org/" target="_blank" rel="noopener noreferrer">pcre<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="/FE_OPS/linux/service/ftp:/ftp.csx.cam.ac.uk/pub/software/programming/pcre/">FTP 下载</a></li> <li><a href="https://sourceforge.net/projects/pcre/files/pcre/" target="_blank" rel="noopener noreferrer">HTTP 下载<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">wget</span> ftp://ftp.pcre.org/pub/pcre/pcre-8.44.tar.gz
</code></pre></div><h5 id="_3-1-2-2-zlib"><a href="#_3-1-2-2-zlib" class="header-anchor">#</a> 3.1.2.2 zlib</h5> <ul><li><a href="http://www.zlib.net/" target="_blank" rel="noopener noreferrer">官网<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://sourceforge.net/projects/libpng/files/zlib/1.2.11/zlib-1.2.11.tar.gz/download?use_mirror=nchc" target="_blank" rel="noopener noreferrer">HTTP 下载<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul> <h5 id="_3-1-2-3-openssl"><a href="#_3-1-2-3-openssl" class="header-anchor">#</a> 3.1.2.3 openssl</h5> <ul><li><a href="https://www.openssl.org/" target="_blank" rel="noopener noreferrer">官网<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul> <h5 id="_3-1-2-4-nginx"><a href="#_3-1-2-4-nginx" class="header-anchor">#</a> 3.1.2.4 nginx</h5> <ul><li><a href="http://nginx.org/en/docs/configure.html" target="_blank" rel="noopener noreferrer">官网<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">wget</span>  http://nginx.org/download/nginx-1.10.1.tar.gz
</code></pre></div><h4 id="_3-1-3-解压文件"><a href="#_3-1-3-解压文件" class="header-anchor">#</a> 3.1.3 解压文件</h4> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">mkdir</span> /root/nginxinstall
<span class="token builtin class-name">cd</span>  /root/nginxinstall
<span class="token comment"># 解压上面安装的包</span>
<span class="token function">tar</span> -zxvf nginx-1.10.1.tar.gz
<span class="token function">tar</span> -zxvf openssl-1.0.2h.tar.gz
<span class="token function">tar</span> -zxvf pcre-8.44.tar.gz
<span class="token function">tar</span> -zxvf zlib-1.2.11.tar.gz
</code></pre></div><h4 id="_3-1-4-配置和安装"><a href="#_3-1-4-配置和安装" class="header-anchor">#</a> 3.1.4 配置和安装</h4> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># 编译</span>
<span class="token comment"># 进入nginx目录并配置。./configure配置命令，配置安装路径等等</span>
<span class="token builtin class-name">cd</span> nginx-1.10.1
./configure --prefix<span class="token operator">=</span>/usr/local/nginx <span class="token punctuation">\</span>
--pid-path<span class="token operator">=</span>/usr/local/nginx/nginx.pid <span class="token punctuation">\</span>
--error-log-path<span class="token operator">=</span>/usr/local/nginx/error.log <span class="token punctuation">\</span>
--http-log-path<span class="token operator">=</span>/usr/local/nginx/access.log <span class="token punctuation">\</span>
--with-http_ssl_module <span class="token punctuation">\</span>
--with-mail --with-mail_ssl_module <span class="token punctuation">\</span>
--with-stream --with-threads <span class="token punctuation">\</span>
--user<span class="token operator">=</span>comex --group<span class="token operator">=</span>comexgroup <span class="token punctuation">\</span>
--with-pcre<span class="token operator">=</span>/root/nginxinstall/pcre-8.44 <span class="token punctuation">\</span>
--with-zlib<span class="token operator">=</span>/root/nginxinstall/zlib-1.2.11 <span class="token punctuation">\</span>
--with-openssl<span class="token operator">=</span>/root/nginxinstall/openssl-1.0.2n
<span class="token comment"># make编译</span>
<span class="token function">make</span> <span class="token operator">&amp;&amp;</span> <span class="token function">make</span> <span class="token function">install</span>

<span class="token comment"># 此目录是nginx可执行文件的目录 -t是检测目录是否合法</span>
/usr/local/nginx/sbin/nginx -t
nginx: <span class="token punctuation">[</span>emerg<span class="token punctuation">]</span> getpwnam<span class="token punctuation">(</span><span class="token string">&quot;comex&quot;</span><span class="token punctuation">)</span> failed

useadd nginx <span class="token comment"># 添加nginx用户</span>
<span class="token function">vi</span> /usr/local/nginx/conf/nginx.conf
user nginx<span class="token punctuation">;</span>
</code></pre></div><h4 id="_3-1-5-管理命令"><a href="#_3-1-5-管理命令" class="header-anchor">#</a> 3.1.5 管理命令</h4> <table><thead><tr><th>命令</th> <th>含义</th></tr></thead> <tbody><tr><td>/usr/local/nginx/sbin/nginx -c /usr/local/nginx/conf/nginx.conf</td> <td>启动</td></tr> <tr><td>ps -ef grep nginx;kill -QUIT 2072</td> <td>从容停止</td></tr> <tr><td>ps -ef grep nginx;kill -TERM 2132; kill -INT 2132</td> <td>快速停止</td></tr> <tr><td>pkill -9 nginx</td> <td>强制停止</td></tr> <tr><td>nginx -t</td> <td>验证 nginx 配置文件是否正确</td></tr> <tr><td>nginx -s reload</td> <td>重启 Nginx 服务</td></tr> <tr><td>kill -HUP 进程号</td> <td>查找当前 nginx 进程号</td></tr></tbody></table> <h4 id="_3-1-6-以服务启动-service"><a href="#_3-1-6-以服务启动-service" class="header-anchor">#</a> 3.1.6 以服务启动 service</h4> <ul><li>Nginx 启动、关闭、重新加载脚本</li> <li>创建文件 etc/init.d/nginx</li></ul> <div class="language-bash extra-class"><pre class="language-bash"><code>/etc/init.d/nginx start
</code></pre></div><div class="language-bash extra-class"><pre class="language-bash"><code><span class="token shebang important">#! /bin/bash</span>

<span class="token comment"># 定义变量</span>
<span class="token assign-left variable">NAME</span><span class="token operator">=</span>nginx
<span class="token assign-left variable">DAEMON</span><span class="token operator">=</span>/usr/local/nginx/sbin/<span class="token variable">$NAME</span> <span class="token comment"># 可执行文件路径</span>
<span class="token assign-left variable">CONFIGFILE</span><span class="token operator">=</span>/usr/local/nginx/conf/<span class="token variable">$NAME</span>.conf
<span class="token assign-left variable">PIDFILE</span><span class="token operator">=</span>/usr/local/nginx/logs/<span class="token variable">$NAME</span>.pid <span class="token comment"># 进程号</span>
<span class="token assign-left variable">SCRIPTNAME</span><span class="token operator">=</span>/etc/init.d/<span class="token variable">$NAME</span>

<span class="token builtin class-name">set</span> -e <span class="token comment"># 报错退出</span>
<span class="token punctuation">[</span> -x <span class="token string">&quot;<span class="token variable">$DAEMON</span>&quot;</span> <span class="token punctuation">]</span> <span class="token operator">||</span> <span class="token builtin class-name">exit</span> <span class="token number">0</span> <span class="token comment"># 没有可执行权限，退出</span>

<span class="token function-name function">do_start</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
 <span class="token variable">$DAEMON</span> -c <span class="token variable">$CONFIGFILE</span>  <span class="token operator">||</span> <span class="token builtin class-name">echo</span> -n <span class="token string">&quot;nginx already running&quot;</span>
 <span class="token assign-left variable">pid</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token function">ps</span> -ef <span class="token operator">|</span> <span class="token function">grep</span> nginx <span class="token operator">|</span> <span class="token function">grep</span> master <span class="token operator">|</span> <span class="token function">awk</span> <span class="token string">'{print $2}'</span><span class="token variable">)</span></span>
 <span class="token builtin class-name">echo</span> <span class="token variable">$pid</span> <span class="token operator">&gt;</span> <span class="token string">&quot;<span class="token variable">$PIDFILE</span>&quot;</span>
<span class="token punctuation">}</span>

<span class="token function-name function">do_stop</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
 <span class="token function">kill</span> -INT <span class="token variable"><span class="token variable">`</span><span class="token function">cat</span> $PIDFILE<span class="token variable">`</span></span> <span class="token operator">||</span> <span class="token builtin class-name">echo</span> -n <span class="token string">&quot;nginx not running&quot;</span>
<span class="token punctuation">}</span>

<span class="token function-name function">do_reload</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
 <span class="token function">kill</span> -HUP <span class="token variable"><span class="token variable">`</span><span class="token function">cat</span> $PIDFILE<span class="token variable">`</span></span> <span class="token operator">||</span> <span class="token builtin class-name">echo</span> -n <span class="token string">&quot;nginx can't reload&quot;</span>
<span class="token punctuation">}</span>

<span class="token keyword">case</span> <span class="token string">&quot;<span class="token variable">$1</span>&quot;</span> <span class="token keyword">in</span>
 start<span class="token punctuation">)</span>
 <span class="token builtin class-name">echo</span> -n <span class="token string">&quot;Starting  <span class="token variable">$NAME</span>&quot;</span>
 do_start
 <span class="token builtin class-name">echo</span> <span class="token string">&quot;.&quot;</span>
 <span class="token punctuation">;</span><span class="token punctuation">;</span>
 stop<span class="token punctuation">)</span>
 <span class="token builtin class-name">echo</span> -n <span class="token string">&quot;Stopping  <span class="token variable">$NAME</span>&quot;</span>
 do_stop
 <span class="token builtin class-name">echo</span> <span class="token string">&quot;.&quot;</span>
 <span class="token punctuation">;</span><span class="token punctuation">;</span>
 reload<span class="token operator">|</span>graceful<span class="token punctuation">)</span>
 <span class="token builtin class-name">echo</span> -n <span class="token string">&quot;Reloading  configuration&quot;</span>
 do_reload
 <span class="token builtin class-name">echo</span> <span class="token string">&quot;.&quot;</span>
 <span class="token punctuation">;</span><span class="token punctuation">;</span>
 restart<span class="token punctuation">)</span>
 <span class="token builtin class-name">echo</span> -n <span class="token string">&quot;Restarting  <span class="token variable">$NAME</span>&quot;</span>
 do_stop
 do_start
 <span class="token builtin class-name">echo</span> <span class="token string">&quot;.&quot;</span>
 <span class="token punctuation">;</span><span class="token punctuation">;</span>
 *<span class="token punctuation">)</span>
 <span class="token builtin class-name">echo</span> <span class="token string">&quot;Usage: <span class="token variable">$SCRIPTNAME</span> {start|stop|reload|restart}&quot;</span> <span class="token operator">&gt;</span><span class="token file-descriptor important">&amp;2</span>
 <span class="token builtin class-name">exit</span> <span class="token number">3</span>
 <span class="token punctuation">;</span><span class="token punctuation">;</span>
<span class="token keyword">esac</span>
<span class="token builtin class-name">exit</span> <span class="token number">0</span>
</code></pre></div><h4 id="_3-1-7-chkconfig"><a href="#_3-1-7-chkconfig" class="header-anchor">#</a> 3.1.7 chkconfig</h4> <ul><li>指定 nginx 脚本可以被 chkconfig 命令管理</li></ul> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment">#开机启动</span>
<span class="token function">chkconfig</span> --add nginx
<span class="token function">chkconfig</span> --list
<span class="token function">chkconfig</span> --level <span class="token number">2345</span> nginx on
<span class="token function">chkconfig</span> nginx off
</code></pre></div></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/FE_OPS/linux/process/" class="prev">
        八、进程管理
      </a></span> <span class="next"><a href="/FE_OPS/linux/network/">
        九、网络
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/FE_OPS/assets/js/app.f808ba23.js" defer></script><script src="/FE_OPS/assets/js/2.6d182741.js" defer></script><script src="/FE_OPS/assets/js/21.5debafb8.js" defer></script>
  </body>
</html>
